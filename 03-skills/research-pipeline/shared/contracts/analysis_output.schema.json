{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "analysis_output.schema.json",
  "title": "Analysis Output Schema v2.3",
  "description": "Contract for index.md YAML frontmatter produced by analyze-research-project, consumed by synthesize-research-project",
  "type": "object",
  "required": ["paper_id", "schema_version", "chunk_index", "chunks_expected", "chunks_read", "analysis_complete"],
  "properties": {
    "paper_id": {
      "type": "string",
      "description": "Paper folder name (e.g., '02-Knowledge_Graphs')"
    },
    "title": {
      "type": "string",
      "description": "Paper title extracted from content"
    },
    "authors": {
      "type": "array",
      "items": { "type": "string" },
      "description": "List of authors"
    },
    "year": {
      "type": ["integer", "null"],
      "description": "Publication year"
    },
    "chunks_expected": {
      "type": "integer",
      "minimum": 1,
      "description": "Number of chunks from _metadata.json"
    },
    "chunks_read": {
      "type": "integer",
      "minimum": 1,
      "description": "Number of chunks actually read (must equal chunks_expected)"
    },
    "analysis_complete": {
      "type": "boolean",
      "const": true,
      "description": "Must be true for valid analysis"
    },
    "schema_version": {
      "type": "string",
      "const": "2.3",
      "description": "Schema version for validation"
    },
    "chunk_index": {
      "type": "object",
      "description": "Per-chunk field assessment for synthesis routing",
      "additionalProperties": {
        "type": "object",
        "required": ["token_count", "fields_found"],
        "properties": {
          "token_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Token count: len(content) // 4"
          },
          "fields_found": {
            "type": "object",
            "description": "3-state field assessment: true|partial|false for each field",
            "additionalProperties": {
              "oneOf": [
                { "type": "boolean" },
                { "type": "string", "enum": ["true", "partial", "false"] }
              ]
            }
          }
        }
      }
    }
  },
  "additionalProperties": true,
  "_meta": {
    "producer": "analyze-research-project",
    "consumer": "synthesize-research-project (build_synthesis_routing.py)",
    "version": "2.3",
    "created": "2025-12-31",
    "token_formula": "len(content) // 4"
  }
}
