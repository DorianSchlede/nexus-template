<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Pipeline v7 - Deep Content</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #141937;
            --bg-tertiary: #1e2447;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2d3554;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* HERO SECTION */
        .hero {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            padding: 3rem 2rem;
            border-bottom: 2px solid var(--border);
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            max-width: 1200px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-blue);
            display: block;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* LAYOUT */
        .container {
            display: flex;
            max-width: 100vw;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* SIDEBAR NAV */
        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section h3 {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-blue);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-purple);
        }

        .nav-step-num {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--accent-blue);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }

        .nav-gate .nav-step-num {
            background: var(--accent-yellow);
        }

        /* SKILL SECTIONS */
        .skill-section {
            margin-bottom: 4rem;
        }

        .skill-header {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .skill-header h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
        }

        /* PHASE SECTIONS */
        .phase-section {
            margin-bottom: 3rem;
        }

        .phase-header {
            background: var(--bg-tertiary);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-purple);
        }

        .phase-header h3 {
            font-size: 1.5rem;
            color: var(--accent-purple);
        }

        /* STEP CARDS */
        .step-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .step-card:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.1);
        }

        .step-card.gate {
            border-left: 4px solid var(--accent-yellow);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(245, 158, 11, 0.05) 100%);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-card.gate .step-number {
            background: linear-gradient(135deg, var(--accent-yellow), var(--accent-red));
        }

        .step-title {
            flex: 1;
        }

        .step-title h4 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .step-meta {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .step-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        /* CONTENT SECTIONS */
        .content-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .content-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            cursor: pointer;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            transition: all 0.2s;
        }

        .content-section-header:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .content-section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        .content-badge {
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .expand-icon {
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .content-section-body {
            margin-top: 1rem;
            display: none;
        }

        .content-section-body.expanded {
            display: block;
        }

        .content-section-header.expanded .expand-icon {
            transform: rotate(90deg);
        }

        /* CODE BLOCKS */
        .code-block {
            margin-bottom: 1.5rem;
        }

        .code-header {
            background: var(--bg-tertiary);
            padding: 0.75rem 1rem;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
            border-bottom: none;
        }

        .code-language {
            color: var(--accent-green);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .code-context {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .code-content {
            background: #0d1117;
            padding: 1rem;
            border-radius: 0 0 6px 6px;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            color: #c9d1d9;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* TABLES */
        .table-wrapper {
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .table-context {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
        }

        th {
            background: var(--bg-primary);
            padding: 0.75rem 1rem;
            text-align: left;
            color: var(--accent-blue);
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        /* TEMPLATES */
        .template-item {
            margin-bottom: 1.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 1rem;
            border-left: 3px solid var(--accent-purple);
        }

        .template-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .template-type {
            background: var(--accent-purple);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .template-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .template-content {
            color: var(--text-secondary);
            font-size: 0.95rem;
            white-space: pre-wrap;
        }

        /* VALIDATION CHECKS */
        .validation-list {
            list-style: none;
        }

        .validation-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-left: 3px solid var(--accent-green);
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .validation-item.critical {
            border-left-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.05);
        }

        .validation-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-top: 0.1rem;
        }

        .validation-item.critical .validation-icon {
            background: var(--accent-red);
        }

        .validation-type {
            display: inline-block;
            background: var(--accent-green);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-right: 0.5rem;
        }

        .validation-item.critical .validation-type {
            background: var(--accent-red);
        }

        /* ERROR HANDLERS */
        .error-handler {
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .error-type {
            background: rgba(239, 68, 68, 0.1);
            padding: 0.75rem 1rem;
            color: var(--accent-red);
            font-weight: 600;
            border-bottom: 1px solid var(--border);
        }

        .error-solution {
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
        }

        /* FILES */
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .file-ref {
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }

        .file-ref.input {
            border-left: 3px solid var(--accent-blue);
        }

        .file-ref.output {
            border-left: 3px solid var(--accent-green);
        }

        /* SUBAGENT CONFIG */
        .subagent-config {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 6px;
            border-left: 3px solid var(--accent-purple);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .config-item {
            display: flex;
            flex-direction: column;
        }

        .config-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-value {
            color: var(--text-primary);
            font-weight: 600;
            margin-top: 0.25rem;
        }

        /* SUBSTEPS */
        .substeps-list {
            list-style: none;
            counter-reset: substep;
        }

        .substep-item {
            counter-increment: substep;
            padding: 0.75rem 1rem;
            padding-left: 3rem;
            margin-bottom: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            position: relative;
        }

        .substep-item::before {
            content: counter(substep);
            position: absolute;
            left: 1rem;
            width: 24px;
            height: 24px;
            background: var(--accent-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* SCRIPTS */
        .script-item {
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 1rem;
            border-left: 3px solid var(--accent-blue);
        }

        .script-header {
            margin-bottom: 0.5rem;
        }

        .script-name {
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 600;
            color: var(--accent-blue);
            font-size: 1.1rem;
        }

        .script-purpose {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .script-command {
            background: #0d1117;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .script-command code {
            color: #c9d1d9;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .script-params {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .script-params code {
            background: var(--bg-primary);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: var(--accent-green);
        }

        /* GAP FIXES */
        .gap-fix-item {
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 1rem;
            border-left: 3px solid var(--accent-yellow);
        }

        .gap-fix-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .gap-id {
            background: var(--accent-yellow);
            color: var(--bg-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .gap-description {
            color: var(--text-primary);
            font-weight: 600;
        }

        .gap-context {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: rgba(245, 158, 11, 0.05);
            border-radius: 4px;
        }

        /* ARCHITECTURE PATTERNS */
        .pattern-item {
            margin-bottom: 1.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 1rem;
            border-left: 3px solid var(--accent-purple);
        }

        .pattern-header {
            margin-bottom: 0.75rem;
        }

        .pattern-name {
            font-weight: 600;
            color: var(--accent-purple);
            font-size: 1.1rem;
        }

        .pattern-description {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .pattern-code {
            background: #0d1117;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 0.75rem;
        }

        .pattern-code pre {
            margin: 0;
        }

        .pattern-code code {
            color: #c9d1d9;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
        }

        /* GATE CRITERIA */
        .criteria-list {
            list-style: none;
        }

        .criteria-item {
            padding: 0.75rem 1rem;
            padding-left: 3rem;
            margin-bottom: 0.5rem;
            background: rgba(245, 158, 11, 0.05);
            border-radius: 6px;
            border-left: 3px solid var(--accent-yellow);
            position: relative;
        }

        .criteria-item::before {
            content: '‚úì';
            position: absolute;
            left: 1rem;
            color: var(--accent-yellow);
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>Research Pipeline v7</h1>
        <p>Deep Content Extraction - Complete Workflow Visualization</p>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-value">3</span>
                <span class="stat-label">Orchestrators</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">16</span>
                <span class="stat-label">Phases</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">29</span>
                <span class="stat-label">Steps</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">8</span>
                <span class="stat-label">Files</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">91</span>
                <span class="stat-label">Code Blocks</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">31</span>
                <span class="stat-label">Tables</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">63</span>
                <span class="stat-label">Validations</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">14</span>
                <span class="stat-label">Scripts</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">9</span>
                <span class="stat-label">Gap Fixes</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">11</span>
                <span class="stat-label">Patterns</span>
            </div>
        </div>
    </div>

    <div class="container">
        <nav class="sidebar">
            <div class="nav-section">
                <h3>create-research-project</h3>
                <div class="nav-item" onclick="scrollToStep(0)">
                    <span class="nav-step-num">0</span>
                    <span>Initialize Task Tracking</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(1)">
                    <span class="nav-step-num">1</span>
                    <span>Create Project Structure</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(2)">
                    <span class="nav-step-num">2</span>
                    <span>Define Research Question (with AI Field Generation)</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(3)">
                    <span class="nav-step-num">3</span>
                    <span>Search Papers</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(4)">
                    <span class="nav-step-num">4</span>
                    <span>Review Abstracts</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(5)">
                    <span class="nav-step-num">5</span>
                    <span>User Selection</span>
                </div>
                <div class="nav-item nav-gate" onclick="scrollToStep(6)">
                    <span class="nav-step-num">6</span>
                    <span>Selection Gate</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(7)">
                    <span class="nav-step-num">7</span>
                    <span>Download Approved Papers</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(8)">
                    <span class="nav-step-num">8</span>
                    <span>Preprocess PDFs ‚Üí Chunks</span>
                </div>
                <div class="nav-item nav-gate" onclick="scrollToStep(9)">
                    <span class="nav-step-num">9</span>
                    <span>Acquisition Report + User Gate</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(10)">
                    <span class="nav-step-num">10</span>
                    <span>Generate Analysis Kit</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(11)">
                    <span class="nav-step-num">11</span>
                    <span>Generate Extraction Guide</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(12)">
                    <span class="nav-step-num">12</span>
                    <span>Generate Orchestrator Instructions + Subagent Allocation Plan</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(13)">
                    <span class="nav-step-num">13</span>
                    <span>Confirm Ready for Execution</span>
                </div>
            </div>
            <div class="nav-section">
                <h3>analyze-research-project</h3>
                <div class="nav-item" onclick="scrollToStep(0)">
                    <span class="nav-step-num">0</span>
                    <span>Initialize Task Tracking</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(1)">
                    <span class="nav-step-num">1</span>
                    <span>Validate Readiness</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(2)">
                    <span class="nav-step-num">2</span>
                    <span>Analyze Papers</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(3)">
                    <span class="nav-step-num">3</span>
                    <span>Validate Analysis Logs</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(4)">
                    <span class="nav-step-num">4</span>
                    <span>Mark Analysis READY_FOR_SYNTHESIS</span>
                </div>
            </div>
            <div class="nav-section">
                <h3>synthesize-research-project</h3>
                <div class="nav-item" onclick="scrollToStep(0)">
                    <span class="nav-step-num">0</span>
                    <span>Initialize Task Tracking</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(1)">
                    <span class="nav-step-num">1</span>
                    <span>Validate Readiness</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(2)">
                    <span class="nav-step-num">2</span>
                    <span>Build Synthesis Routing Table</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(3)">
                    <span class="nav-step-num">3</span>
                    <span>Calculate Subagent Allocation</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(4)">
                    <span class="nav-step-num">4</span>
                    <span>Generate Subagent Prompts</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(5)">
                    <span class="nav-step-num">5</span>
                    <span>Spawn Batch Extraction Subagents</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(6)">
                    <span class="nav-step-num">6</span>
                    <span>Verify Subagent Outputs</span>
                </div>
                <div class="nav-item nav-gate" onclick="scrollToStep(7)">
                    <span class="nav-step-num">7</span>
                    <span>Aggregate Patterns</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(8)">
                    <span class="nav-step-num">8</span>
                    <span>Generate Synthesis Report</span>
                </div>
                <div class="nav-item" onclick="scrollToStep(9)">
                    <span class="nav-step-num">9</span>
                    <span>Mark Project COMPLETE</span>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <div class="skill-section" id="skill-create-research-project">
                <div class="skill-header">
                    <h2>create-research-project</h2>
                    <p>Create research projects with paper selection, download, and preprocessing (Phase 1). Load when user says 'create research project', 'new research', 'start research on [topic]'. Delivers analysis-ready chunks. For EXECUTING analysis, use 'execute-research-project' skill.</p>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase A: RESEARCH DEFINITION</h3>
                    </div>
                    <div class="step-card" id="step-0">
                        <div class="step-header">
                            <div class="step-number">0</div>
                            <div class="step-title">
                                <h4>Initialize Task Tracking</h4>
                                <div class="step-meta">Phase ? ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            MANDATORY: Use TodoWrite at start of skill: Update todos as each step completes. After completing each step, mark the corresponding checkbox in `01-planning/steps.md`: | After Step | Mark Complete in steps.md | |------------|---------------------------| | Step 1 | `- [x] Create project structure` | | Step 2 | `- [x] Define research question and extraction schema` | | Step 3 | `- [x] Search academic databases` | | Step 4 | `- [x] Review abstracts and assess relevance` | | Step 5-6 | `- [x] User approves paper selection` | | Step 7 | `- [x] Download approved papers` | | Step 8 | `- [x] Preprocess PDFs to markdown chunks` | | Step 9 | `- [x] Verify acquisition completeness` | Use Edit tool to change `- [ ]` to `- [x]` for each completed task. After Step 2 (Define RQ): , update plan.md: After ...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**MANDATORY: Use TodoWrite at start of skill:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>TodoWrite with initial todos:
- [ ] Create project structure (Step 1)
- [ ] Define research question ‚Üí _briefing.md (Step 2)
- [ ] Search papers ‚Üí _search_results.md (Step 3)
- [ ] Review abstracts ‚Üí _abstract_reviews.md (Step 4)
- [ ] User selection ‚Üí _selection_log.md (Step 5)
- [ ] Selection gate approval (Step 6)
- [ ] Download approved papers (Step 7)
- [ ] Preprocess PDFs ‚Üí chunks (Step 8)
- [ ] Acquisition report + user gate (Step 9)
- [ ] Generate _analysis_kit.md + validate (Step 10)
- [ ] Generate _extraction_guide.md + validate (Step 11)
- [ ] Generate orchestrator instructions in plan.md + validate (Step 12)
- [ ] Readiness gate ‚Üí handoff (Step 13)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>s` |
| Step 9 | `- [x] Verify acquisition completeness` |

**Use Edit tool to change `- [ ]` to `- [x]` for each completed task.**

### Updating plan.md

**After Step 2 (Define RQ)**, update plan.md:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Research Question

**Primary RQ**: {actual research question from _briefing.md}

**Focus Areas**:
- {focus area 1}
- {focus area 2}

## Extraction Schema

| Field | Description | Priority |
|-------|-------------|----------|
| {field1} | {description1} | high |
| {field2} | {description2} | medium |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>ption | Priority |
|-------|-------------|----------|
| {field1} | {description1} | high |
| {field2} | {description2} | medium |
```

**After Step 6 (Selection Gate)**, update plan.md Current State:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Current State

| Metric | Value |
|--------|-------|
| Phase | 2-Selection (complete) |
| Papers Approved | {N} |
| Papers Downloaded | 0 |
| Papers with Chunks | 0 |
| Papers Analyzed | 0 |</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>**After completing each step, mark the corresponding checkbox in `01-planning/steps.md`:**</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>After Step</th>
                                                <th>Mark Complete in steps.md</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Step 1</td>
                                                <td>`- [x] Create project structure`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 2</td>
                                                <td>`- [x] Define research question and extraction schema`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>`- [x] Search academic databases`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 4</td>
                                                <td>`- [x] Review abstracts and assess relevance`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 5-6</td>
                                                <td>`- [x] User approves paper selection`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 7</td>
                                                <td>`- [x] Download approved papers`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 8</td>
                                                <td>`- [x] Preprocess PDFs to markdown chunks`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 9</td>
                                                <td>`- [x] Verify acquisition completeness`</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Extraction Schema</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Description</th>
                                                <th>Priority</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{field1}</td>
                                                <td>{description1}</td>
                                                <td>high</td>
                                            </tr>
                                            <tr>
                                                <td>{field2}</td>
                                                <td>{description2}</td>
                                                <td>medium</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Current State</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Phase</td>
                                                <td>2-Selection (complete)</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Approved</td>
                                                <td>{N}</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Downloaded</td>
                                                <td>0</td>
                                            </tr>
                                            <tr>
                                                <td>Papers with Chunks</td>
                                                <td>0</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Analyzed</td>
                                                <td>0</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            acquisition completeness` |
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">
                                <h4>Create Project Structure</h4>
                                <div class="step-meta">Phase A ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Use create-project skill internally: Result:
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Use create-project skill internally:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 00-system/skills/projects/create-project/scripts/init_project.py \
  "{Project Name}" --type research</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Use create-project skill internally:**

```bash
python 00-system/skills/projects/create-project/scripts/init_project.py \
  "{Project Name}" --type research
```

**Result:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>02-projects/NN-{slug}/
‚îú‚îÄ‚îÄ 01-planning/
‚îÇ   ‚îú‚îÄ‚îÄ overview.md    # type: research
‚îÇ   ‚îú‚îÄ‚îÄ plan.md
‚îÇ   ‚îî‚îÄ‚îÄ steps.md
‚îú‚îÄ‚îÄ 02-resources/      # Papers will go here
‚îú‚îÄ‚îÄ 03-working/        # Selection tracking
‚îî‚îÄ‚îÄ 04-outputs/        # Synthesis outputs (Phase 2)</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">00-system/skills/projects/create-project/scripts/init_project.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 00-system/skills/projects/create-project/scripts/init_project.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">
                                <h4>Define Research Question (with AI Field Generation)</h4>
                                <div class="step-meta">Phase A ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Gap G5 Fix: AI-Generated Field Suggestions Gap G22a Fix: Add research_purpose field Interactive session to create `02-resources/_briefing.md`: When generating field suggestions, follow this template: Output: `02-resources/_briefing.md` Token Impact: +30-50 tokens for research_purpose (validated as acceptable)
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Identify 6-10 extraction fields that would capture key insights</li>
                                    <li class="substep-item">For each field provide:</li>
                                    <li class="substep-item">Flag any generic fields that might match too much content (sparsity risk)</li>
                                    <li class="substep-item">Ensure fields are MECE (mutually exclusive, collectively exhaustive)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Gap G5 Fix: AI-Generated Field Suggestions**
**Gap G22a Fix: Add research_purpose field**

Interactive session to create `02-resources/_briefing.md`:

### 2.1 Research Question</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>AI: What is your main research question?

User: "What are foundational ontologies for digital work?"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>User: "What are foundational ontologies for digital work?"
```

### 2.2 Research Purpose (G22a - NEW)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>AI: Why does this research matter? What will you use the insights for?
    (This helps subagents understand context and make better extraction decisions)

User: "Validate the 8-entity hypothesis for our UDWO metamodel"

AI: Got it. I'll include this as research_purpose in the briefing.</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>```

### 2.3 AI Field Generation (G5)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>AI: Based on your research question, I'll suggest extraction fields.

   ANALYZING RESEARCH QUESTION...
   Domain detected: {detected_domain}
   Key concepts: {extracted_concepts}

   SUGGESTED FIELDS:
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ 1. {field_1}        - {description_1}                       ‚îÇ
   ‚îÇ 2. {field_2}        - {description_2}                       ‚îÇ
   ‚îÇ 3. {field_3}        - {description_3}                       ‚îÇ
   ‚îÇ 4. {field_4}        - {description_4}                       ‚îÇ
   ‚îÇ 5. {field_5}        - {description_5}                       ‚îÇ
   ‚îÇ 6. {field_6}        - {description_6}                       ‚îÇ
   ‚îÇ 7. {field_7}        - {description_7}                       ‚îÇ
   ‚îÇ 8. {field_8}        - {description_8}                       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

   FIELD QUALITY CHECK:
   ‚ö† "{generic_field}" is generic - consider removing if not research-focused
   ‚úì All other fields are domain-specific

   Commands:
   - 'ok' ‚Üí Accept all fields
   - 'remove N' ‚Üí Remove field N (e.g., 'remove 6')
   - 'add FIELD_NAME: description' ‚Üí Add custom field
   - 'edit N: new description' ‚Üí Edit description

User: remove 6, add ai_integration: How ontology enables AI agents

AI: Updated fields (8 total). Confirm? [Y/N]

User: Y

AI: Creating _briefing.md with research_purpose and 8 extraction fields...</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>```

### FIELD GENERATION PROMPT TEMPLATE (for AI)

When generating field suggestions, follow this template:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Given research question: "{RQ}"
Given domain hints: "{domain}"

1. Identify 6-10 extraction fields that would capture key insights
2. For each field provide:
   - field_key (snake_case, specific to domain)
   - description (what it captures, 10-15 words)
   - priority (high/medium based on RQ relevance)
3. Flag any generic fields that might match too much content (sparsity risk)
4. Ensure fields are MECE (mutually exclusive, collectively exhaustive)

AVOID generic fields like: "key_findings", "main_points", "summary"
PREFER specific fields like: "entity_types", "algorithm_complexity", "security_mechanisms"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>generic fields like: "key_findings", "main_points", "summary"
PREFER specific fields like: "entity_types", "algorithm_complexity", "security_mechanisms"
```

**Output: `02-resources/_briefing.md`**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
research_question: "{RQ}"

# G22a: WHY this research matters (provides context to subagents)
research_purpose: "{purpose statement - what will you use insights for}"

domain: "{field/domain}"

extraction_schema:
  - field: {field_1}
    description: "{description_1}"
    priority: high
  - field: {field_2}
    description: "{description_2}"
    priority: high
  - field: {field_3}
    description: "{description_3}"
    priority: medium
  # ... AI-generated fields confirmed by user

focus_areas: [...]
skip_sections: ["Acknowledgments", "Author Contributions", "Funding"]
---</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            ‚ö† "{generic_field}" is generic - consider removing if not research-focused
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">requirement</span>
                                            fields are MECE (mutually exclusive, collectively exhaustive)
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Gap Fixes</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">G5</span>
                                        <span class="gap-description">Fix: AI-Generated Field Suggestions**</span>
                                    </div>
                                    <div class="gap-context">**Gap G5 Fix: AI-Generated Field Suggestions**
**Gap G22a Fix: Add research_purpose field**

Interactive session to create `02-resources/_briefing.md`:

### 2.1 Research Question

```
AI: What is your main research question?

User: "What are found</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">G22A</span>
                                        <span class="gap-description">Fix: Add research_purpose field**</span>
                                    </div>
                                    <div class="gap-context">**Gap G5 Fix: AI-Generated Field Suggestions**
**Gap G22a Fix: Add research_purpose field**

Interactive session to create `02-resources/_briefing.md`:

### 2.1 Research Question

```
AI: What is your main research question?

User: "What are foundational ontologies for digital work?"
```

##</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">22A</span>
                                        <span class="gap-description">- NEW)</span>
                                    </div>
                                    <div class="gap-context">uestion?

User: "What are foundational ontologies for digital work?"
```

### 2.2 Research Purpose (G22a - NEW)

```
AI: Why does this research matter? What will you use the insights for?
    (This helps subagents understand context and make better extraction decisions)

User: "Validate the 8-entity</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">22A</span>
                                        <span class="gap-description">WHY this research matters (provides context to subagents)</span>
                                    </div>
                                    <div class="gap-context">_mechanisms"
```

**Output: `02-resources/_briefing.md`**

```yaml
---
research_question: "{RQ}"

# G22a: WHY this research matters (provides context to subagents)
research_purpose: "{purpose statement - what will you use insights for}"

domain: "{field/domain}"

extraction_schema:
  - field: {field</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">
                                <h4>Search Papers</h4>
                                <div class="step-meta">Phase A ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Use `paper-search` skill: Output: `02-resources/_search_results.md`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Use `paper-search` skill:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>[Load paper-search skill]
Search: "{research question}"
Save to: 02-resources/_search_results.md</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>**Use `paper-search` skill:**

```
[Load paper-search skill]
Search: "{research question}"
Save to: 02-resources/_search_results.md
```

**Output: `02-resources/_search_results.md`**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
search_query: "{query}"
search_date: "{date}"
total_results: {N}
---

# Search Results

## Paper 1: {Title}
- Authors: ...
- Abstract: "..."
- DOI: ...
- PDF: {URL if available}
- Status: PENDING_REVIEW</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase B: PAPER SELECTION</h3>
                    </div>
                    <div class="step-card" id="step-4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">
                                <h4>Review Abstracts</h4>
                                <div class="step-meta">Phase B ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            AI reads each abstract and assesses relevance: See [references/abstract_review.md](references/abstract_review.md) for scoring criteria. Output: `02-resources/_abstract_reviews.md`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>**Output: `02-resources/_abstract_reviews.md`**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
reviewed_date: "{date}"
recommended: {N}
flagged: {N}
rejected: {N}
---

## Paper 1: {Title}
- Relevance Score: 5/5
- Recommendation: APPROVE
- Rationale: "..."</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-5">
                        <div class="step-header">
                            <div class="step-number">5</div>
                            <div class="step-title">
                                <h4>User Selection</h4>
                                <div class="step-meta">Phase B ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Present recommendations for approval: Output: `03-working/_selection_log.md`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">[x] Paper Title (5/5)</li>
                                    <li class="substep-item">[x] Paper Title (4/5)</li>
                                    <li class="substep-item">[ ] Paper Title (3/5) - {concern}</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Present recommendations for approval:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>APPROVED ({N} papers):
  1. [x] Paper Title (5/5)
  2. [x] Paper Title (4/5)

NEEDS REVIEW ({N} papers):
  3. [ ] Paper Title (3/5) - {concern}

REJECTED ({N} papers):
  [SKIP] Paper Title (1/5) - Wrong domain

Commands: 'approve all', 'add N', 'remove N', 'show N'</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Paper Title (3/5) - {concern}

REJECTED ({N} papers):
  [SKIP] Paper Title (1/5) - Wrong domain

Commands: 'approve all', 'add N', 'remove N', 'show N'
```

**Output: `03-working/_selection_log.md`**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
schema_version: "3.0"
selection_date: "{date}"
total_approved: {N}
approved_by_user: true
user_instruction: "{what user said}"

# Acquisition tracking (populated in Step 7-8)
acquisition:
  attempted_at: null
  downloaded: 0
  unavailable: 0
  preprocessed: 0
  chunks_total: 0

papers: []
unavailable_papers: []
---</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card gate" id="step-6">
                        <div class="step-header">
                            <div class="step-number">6</div>
                            <div class="step-title">
                                <h4>Selection Gate</h4>
                                <div class="step-meta">Phase B ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Confirm paper selection before acquisition: On 'Y':: Proceed to Phase C (Acquisition)
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Confirm paper selection before acquisition:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Selection complete!

Research Question: "{RQ}"
Papers Selected: {N}

Ready to download and preprocess papers?

[Y] Yes ‚Üí Proceed to acquisition
[N] No, modify selection
[S] Save and continue later</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase C: PAPER ACQUISITION</h3>
                    </div>
                    <div class="step-card" id="step-7">
                        <div class="step-header">
                            <div class="step-number">7</div>
                            <div class="step-title">
                                <h4>Download Approved Papers</h4>
                                <div class="step-meta">Phase C ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Download all approved papers using automated batch download: The script automatically: Resolves multiple URLs per paper (arXiv ‚Üí S2 ‚Üí Unpaywall ‚Üí direct) Downloads in parallel with rate limiting Verifies PDFs (catches HTML error pages) Retries failed downloads with exponential backoff Generates `_download_report.md` with success/fail stats 1. **arXiv ID** (if available) - Most reliable 2. **DOI via Semantic Scholar** - Often has PDF + arXiv link 3. **DOI via Unpaywall** - OA from repositories 4. **Title search on arXiv** - Fallback for paywalled papers 5. **Direct URL** - Original URL if from known OA source If batch fails for specific papers, try individual downloads: After downloads, update the selection log with status:
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">**arXiv ID** (if available) - Most reliable</li>
                                    <li class="substep-item">**DOI via Semantic Scholar** - Often has PDF + arXiv link</li>
                                    <li class="substep-item">**DOI via Unpaywall** - OA from repositories</li>
                                    <li class="substep-item">**Title search on arXiv** - Fallback for paywalled papers</li>
                                    <li class="substep-item">**Direct URL** - Original URL if from known OA source</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Download all approved papers using automated batch download:**

### Batch Download (Recommended)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Download all papers from selection log
python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \
  --input "02-projects/NN-{slug}/03-working/_selection_log.md" \
  --output "02-projects/NN-{slug}/02-resources/" \
  --parallel 3</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Direct URL** - Original URL if from known OA source

### Single Paper Download (Fallback)

If batch fails for specific papers, try individual downloads:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># By arXiv ID (preferred)
python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \
  --arxiv "2506.23998" \
  --output "02-projects/NN-{slug}/02-resources/"

# By DOI
python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \
  --doi "10.1177/08944393231220483" \
  --output "02-projects/NN-{slug}/02-resources/"

# By title search
python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \
  --title "Paper Title Here" \
  --output "02-projects/NN-{slug}/02-resources/"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>le search
python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \
  --title "Paper Title Here" \
  --output "02-projects/NN-{slug}/02-resources/"
```

### Progress Display</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Downloading papers...
  [1/25] Auto-TA (arxiv:2506.23998)... OK
  [2/25] SFT-TA (arxiv:2509.17167)... OK
  [3/25] Thematic-LM (ACM DOI)... UNAVAILABLE (paywall)
  [4/25] De Paoli (SAGE)... OK (via Unpaywall)
  ...

Downloaded: 18/25
Unavailable: 7 (paywalled, no OA version)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Downloaded: 18/25
Unavailable: 7 (paywalled, no OA version)
```

### Update _selection_log.md

After downloads, update the selection log with status:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>papers:
  - id: "Auto_TA"
    title: "Auto-TA: Automated Thematic Analysis"
    arxiv: "2506.23998"
    status: "downloaded"
    pdf_path: "02-resources/Auto_TA/Auto_TA.pdf"

  - id: "Thematic_LM"
    title: "Thematic-LM: Multi-agent System"
    doi: "10.1145/3696410.3714595"
    status: "unavailable"
    reason: "ACM paywall, no preprint found"

unavailable_papers:
  - title: "Thematic-LM"
    doi: "10.1145/3696410.3714595"
    reason: "ACM paywall"</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-green); margin-bottom: 0.5rem; margin-top: 1rem;">Outputs</h5>
                                <div class="file-list">
                                    <div class="file-ref output" title="">_download_report.md</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/paper-search/scripts/paper_download.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-8">
                        <div class="step-header">
                            <div class="step-number">8</div>
                            <div class="step-title">
                                <h4>Preprocess PDFs ‚Üí Chunks</h4>
                                <div class="step-meta">Phase C ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Convert all downloaded PDFs to markdown chunks:
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Convert all downloaded PDFs to markdown chunks:**

### Batch Preprocessing (Recommended)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \
  "02-projects/NN-{slug}/02-resources/" \
  --batch \
  --recursive</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>sh
python 03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \
  "02-projects/NN-{slug}/02-resources/" \
  --batch \
  --recursive
```

### Custom Chunk Settings (Optional)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Smaller chunks with more overlap
python 03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \
  "02-projects/NN-{slug}/02-resources/" \
  --batch --recursive \
  --max-lines 500 \
  --overlap 50</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>ls/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \
  "02-projects/NN-{slug}/02-resources/" \
  --batch --recursive \
  --max-lines 500 \
  --overlap 50
```

### Result Per Paper</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>02-resources/{paper}/
‚îú‚îÄ‚îÄ {paper}.pdf           # Original PDF
‚îú‚îÄ‚îÄ {paper}_1.md          # Chunk 1
‚îú‚îÄ‚îÄ {paper}_2.md          # Chunk 2
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ _metadata.json        # Chunk index</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>‚îî‚îÄ‚îÄ _metadata.json        # Chunk index
```

### Progress Display</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Preprocessing PDFs...
  [1/18] Auto_TA... 4 chunks
  [2/18] SFT_TA... 3 chunks
  [3/18] De_Paoli... 5 chunks
  ...

Preprocessed: 18 papers ‚Üí 52 chunks total</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Preprocessed: 18 papers ‚Üí 52 chunks total
```

### Update _selection_log.md</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>acquisition:
  attempted_at: "2025-12-19T14:30:00"
  downloaded: 18
  unavailable: 7
  preprocessed: 18
  chunks_total: 52

papers:
  - id: "Auto_TA"
    status: "ready"        # ready = downloaded + preprocessed
    chunks: 4</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/pdf-preprocess/scripts/pdf_to_markdown.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card gate" id="step-9">
                        <div class="step-header">
                            <div class="step-number">9</div>
                            <div class="step-title">
                                <h4>Acquisition Report + User Gate</h4>
                                <div class="step-meta">Phase C ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Present acquisition results for user approval: | User Input | Action | |------------|--------| | **Y** | Proceed to Step 10 (Readiness Gate) | | **R** | Retry downloads (try alternative URLs) | | **A** | Return to Step 3 (search for alternatives) | | **S** | Save state, exit (can resume later) | After acquisition complete, populate the Paper Corpus table in plan.md: Calculate subagent allocation based on chunk count: <=4 chunks ‚Üí 1 subagent 5-12 chunks ‚Üí 1 subagent >12 chunks ‚Üí 2 subagents (split at chunk 6) Also update Current State: If <50% of papers acquired:
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Searching for arXiv preprints of paywalled papers</li>
                                    <li class="substep-item">Adding alternative papers on similar topics</li>
                                    <li class="substep-item">Proceeding with limited corpus</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Present acquisition results for user approval:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
PAPER ACQUISITION COMPLETE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Research Project: {name}

‚úì Downloaded:    18 papers
‚úó Unavailable:   7 papers (paywalled)
‚úì Preprocessed:  18 papers ‚Üí 52 chunks

Unavailable papers:
  ‚Ä¢ Thematic-LM (ACM paywall)
  ‚Ä¢ LLM-in-the-loop (ACL paywall)
  ‚Ä¢ CollabCoder (ACM paywall)
  ‚Ä¢ ... (+4 more)

Ready to proceed with 18 papers?

[Y] Yes, proceed to execution
[R] Retry failed downloads
[A] Add alternative papers (search again)
[S] Save and continue later
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>Step 3 (search for alternatives) |
| **S** | Save state, exit (can resume later) |

### Update plan.md with Paper Corpus

**After acquisition complete, populate the Paper Corpus table in plan.md:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Paper Corpus

### Papers Ready for Analysis

| Paper ID | Chunks | Est. Tokens | Subagents | Status |
|----------|--------|-------------|-----------|--------|
| Auto_TA | 4 | ~20,000 | 1 | ready |
| SFT_TA | 3 | ~15,000 | 1 | ready |
| De_Paoli_2024 | 8 | ~40,000 | 1 | ready |
| Large_Paper | 14 | ~85,000 | 2 | ready |

### Unavailable Papers

| Paper | Reason |
|-------|--------|
| Thematic-LM | ACM paywall |
| CollabCoder | ACM paywall |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>ywall |
```

**Calculate subagent allocation based on chunk count:**
- <=4 chunks ‚Üí 1 subagent
- 5-12 chunks ‚Üí 1 subagent
- >12 chunks ‚Üí 2 subagents (split at chunk 6)

**Also update Current State:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Current State

| Metric | Value |
|--------|-------|
| Phase | 3-Acquisition (complete) |
| Papers Approved | 25 |
| Papers Downloaded | 18 |
| Papers with Chunks | 18 |
| Papers Analyzed | 0 |
| Total Chunks | 52 |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>tion (complete) |
| Papers Approved | 25 |
| Papers Downloaded | 18 |
| Papers with Chunks | 18 |
| Papers Analyzed | 0 |
| Total Chunks | 52 |
```

### Minimum Threshold

If <50% of papers acquired:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚ö†Ô∏è WARNING: Only {N} of {total} papers acquired ({percent}%)

This may limit synthesis quality. Consider:
  1. Searching for arXiv preprints of paywalled papers
  2. Adding alternative papers on similar topics
  3. Proceeding with limited corpus

Continue anyway? [Y/N]</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>### Decision Handling</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>User Input</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>**Y**</td>
                                                <td>Proceed to Step 10 (Readiness Gate)</td>
                                            </tr>
                                            <tr>
                                                <td>**R**</td>
                                                <td>Retry downloads (try alternative URLs)</td>
                                            </tr>
                                            <tr>
                                                <td>**A**</td>
                                                <td>Return to Step 3 (search for alternatives)</td>
                                            </tr>
                                            <tr>
                                                <td>**S**</td>
                                                <td>Save state, exit (can resume later)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>### Papers Ready for Analysis</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Paper ID</th>
                                                <th>Chunks</th>
                                                <th>Est. Tokens</th>
                                                <th>Subagents</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Auto_TA</td>
                                                <td>4</td>
                                                <td>~20,000</td>
                                                <td>1</td>
                                                <td>ready</td>
                                            </tr>
                                            <tr>
                                                <td>SFT_TA</td>
                                                <td>3</td>
                                                <td>~15,000</td>
                                                <td>1</td>
                                                <td>ready</td>
                                            </tr>
                                            <tr>
                                                <td>De_Paoli_2024</td>
                                                <td>8</td>
                                                <td>~40,000</td>
                                                <td>1</td>
                                                <td>ready</td>
                                            </tr>
                                            <tr>
                                                <td>Large_Paper</td>
                                                <td>14</td>
                                                <td>~85,000</td>
                                                <td>2</td>
                                                <td>ready</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>### Unavailable Papers</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Paper</th>
                                                <th>Reason</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Thematic-LM</td>
                                                <td>ACM paywall</td>
                                            </tr>
                                            <tr>
                                                <td>CollabCoder</td>
                                                <td>ACM paywall</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Current State</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Phase</td>
                                                <td>3-Acquisition (complete)</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Approved</td>
                                                <td>25</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Downloaded</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers with Chunks</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Analyzed</td>
                                                <td>0</td>
                                            </tr>
                                            <tr>
                                                <td>Total Chunks</td>
                                                <td>52</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase D: READINESS GATE</h3>
                    </div>
                    <div class="step-card" id="step-10">
                        <div class="step-header">
                            <div class="step-number">10</div>
                            <div class="step-title">
                                <h4>Generate Analysis Kit</h4>
                                <div class="step-meta">Phase D ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Create `_analysis_kit.md` for subagent context: This file consolidates everything subagents need to analyze papers, eliminating redundant reads. Use template from:: `references/analysis_kit_template.md` Populate with: Research question from `_briefing.md` Extraction schema (fields, descriptions, priorities) Focus areas Validation contract (required frontmatter fields) Output:: `02-resources/_analysis_kit.md` After creating `_analysis_kit.md`, verify: If validation fails:: Regenerate the file before proceeding.
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>rch question from `_briefing.md`
- Extraction schema (fields, descriptions, priorities)
- Focus areas
- Validation contract (required frontmatter fields)

**Output:** `02-resources/_analysis_kit.md`</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
project_id: "{project_id}"
project_path: "02-projects/{project_id}"
generated: "{date}"
---

# Analysis Kit for {project_name}

## Research Question
{from _briefing.md}

## Extraction Schema
| Field | Description | Priority |
|-------|-------------|----------|
{from _briefing.md extraction_schema}

## Validation Contract
Your output will be validated:
- chunks_read == chunks_expected
- analysis_complete == true
- high_priority_fields_found >= 1</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>r output will be validated:
- chunks_read == chunks_expected
- analysis_complete == true
- high_priority_fields_found >= 1
```

### Step 10 Validation

**After creating `_analysis_kit.md`, verify:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>kit = read("02-resources/_analysis_kit.md")
assert kit.frontmatter.project_id == project_id, "Wrong project_id"
assert kit.frontmatter.generated is not None, "Missing timestamp"
assert "## Research Question" in kit, "Missing research question section"
assert "## Extraction Schema" in kit, "Missing extraction schema"
assert "## Validation Contract" in kit, "Missing validation contract"</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">6</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            **
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            kit.frontmatter.project_id == project_id, "Wrong project_id"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            kit.frontmatter.generated is not None, "Missing timestamp"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Research Question" in kit, "Missing research question section"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Extraction Schema" in kit, "Missing extraction schema"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Validation Contract" in kit, "Missing validation contract"
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-blue); margin-bottom: 0.5rem;">Inputs</h5>
                                <div class="file-list">
                                    <div class="file-ref input" title="">_briefing.md</div>
                                </div>
                                <h5 style="color: var(--accent-green); margin-bottom: 0.5rem; margin-top: 1rem;">Outputs</h5>
                                <div class="file-list">
                                    <div class="file-ref output" title="">_analysis_kit.md</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-11">
                        <div class="step-header">
                            <div class="step-number">11</div>
                            <div class="step-title">
                                <h4>Generate Extraction Guide</h4>
                                <div class="step-meta">Phase D ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Create `_extraction_guide.md` with project-specific extraction examples: Use template from:: `03-skills/research-pipeline/shared/paper-analyze-core/references/extraction_guide_template.md` Populate with: Field-specific examples for EACH field in `_briefing.md` Controlled vocabulary for this domain Good/bad extraction examples Output:: `02-resources/_extraction_guide.md` After creating `_extraction_guide.md`, verify: If validation fails:: Add missing field definitions before proceeding.
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>**Populate with:**
- Field-specific examples for EACH field in `_briefing.md`
- Controlled vocabulary for this domain
- Good/bad extraction examples

**Output:** `02-resources/_extraction_guide.md`</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Extraction Guide: {project_name}

## Field Definitions

### Field: {field_1_name}
**Definition**: {from briefing}
**Format**: Array of strings | Array of objects | String
**Priority**: high | medium

**Example GOOD extraction**:
{domain-specific example}

**Example BAD extraction**:
{what to avoid}

### Field: {field_2_name}
...

## Controlled Vocabulary

| Term | Use When |
|------|----------|
| {standard_term_1} | {when paper uses synonyms} |
| {standard_term_2} | {when paper uses synonyms} |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>----|----------|
| {standard_term_1} | {when paper uses synonyms} |
| {standard_term_2} | {when paper uses synonyms} |
```

### Step 11 Validation

**After creating `_extraction_guide.md`, verify:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>guide = read("02-resources/_extraction_guide.md")
briefing = read("02-resources/_briefing.md")

# Count fields in guide
guide_fields = count_sections_matching("### Field:")
briefing_fields = len(briefing.extraction_schema)

assert guide_fields == briefing_fields, \
    f"Field count mismatch: guide has {guide_fields}, briefing has {briefing_fields}"
assert "## Controlled Vocabulary" in guide, "Missing controlled vocabulary section"</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>## Controlled Vocabulary</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Term</th>
                                                <th>Use When</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{standard_term_1}</td>
                                                <td>{when paper uses synonyms}</td>
                                            </tr>
                                            <tr>
                                                <td>{standard_term_2}</td>
                                                <td>{when paper uses synonyms}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            **
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            guide_fields == briefing_fields, \
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Controlled Vocabulary" in guide, "Missing controlled vocabulary section"
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-green); margin-bottom: 0.5rem; margin-top: 1rem;">Outputs</h5>
                                <div class="file-list">
                                    <div class="file-ref output" title="">_extraction_guide.md</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-12">
                        <div class="step-header">
                            <div class="step-number">12</div>
                            <div class="step-title">
                                <h4>Generate Orchestrator Instructions + Subagent Allocation Plan</h4>
                                <div class="step-meta">Phase D ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Add orchestrator instructions to `plan.md`: Use template from:: `references/orchestrator_template.md` Read each paper's `_metadata.json` and calculate subagent allocation: The allocation table MUST be written to plan.md so execute-research-project can read it: Populate with: Project path constants Subagent prompt template with `{paper_id}` and `{chunks}` variables Split prompts for large papers (with specific chunk ranges) Merge prompts for multi-part papers Validation checks (Phase 4.5) Synthesis instructions Key sections to add: 1. **Constants** - PROJECT, PAPERS, KIT, METHODOLOGY paths 2. **Subagent Allocation Plan** - Pre-calculated table from 12.1 3. **Phase 4** - Subagent prompts (standard + split + merge) 4. **Phase 4.5** - Validation checks (hallucination prevention) 5. **Phase 5**...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">**Constants** - PROJECT, PAPERS, KIT, METHODOLOGY paths</li>
                                    <li class="substep-item">**Subagent Allocation Plan** - Pre-calculated table from 12.1</li>
                                    <li class="substep-item">**Phase 4** - Subagent prompts (standard + split + merge)</li>
                                    <li class="substep-item">**Phase 4.5** - Validation checks (hallucination prevention)</li>
                                    <li class="substep-item">**Phase 5** - Synthesis prompt</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>an.md`:**

**Use template from:** `references/orchestrator_template.md`

### 12.1: Calculate Subagent Allocation (CRITICAL)

**Read each paper's `_metadata.json` and calculate subagent allocation:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Token estimation: Each chunk ‚âà 10-15k tokens (1000 lines √ó ~50 chars/line)
# Usable budget: 74k tokens per subagent (after 26k methodology overhead)

allocation = []
for paper in papers_with_chunks:
    metadata = read(f"02-resources/papers/{paper}/_metadata.json")
    chunks = metadata.total_chunks
    chars = metadata.total_chars
    tokens_est = (chars / 5) * 1.3

    # Allocation rules
    if chunks <= 6:
        subagents = 1
        splits = [f"1-{chunks}"]
    elif chunks <= 12:
        subagents = 2
        splits = ["1-6", f"7-{chunks}"]
    elif chunks <= 18:
        subagents = 3
        splits = ["1-6", "7-12", f"13-{chunks}"]
    else:
        # Split into 5-6 chunk segments
        subagents = ceil(chunks / 6)
        splits = [f"{i*6+1}-{min((i+1)*6, chunks)}" for i in range(subagents)]

    allocation.append({
        "paper_id": paper,
        "chunks": chunks,
        "tokens_est": tokens_est,
        "subagents": subagents,
        "splits": splits
    })</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>"subagents": subagents,
        "splits": splits
    })
```

### 12.2: Write Allocation Table to plan.md

**The allocation table MUST be written to plan.md so execute-research-project can read it:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Subagent Allocation Plan

| Paper ID | Chunks | Est. Tokens | Subagents | Splits |
|----------|--------|-------------|-----------|--------|
| Small_Paper | 3 | ~35,000 | 1 | 1-3 |
| Medium_Paper | 6 | ~70,000 | 1 | 1-6 |
| Large_Paper | 10 | ~120,000 | 2 | 1-6, 7-10 |
| Survey_Paper | 16 | ~190,000 | 3 | 1-6, 7-12, 13-16 |

**Total subagents**: 7
**Max concurrent**: 15
**Estimated batches**: 1</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Phase 5** - Synthesis prompt

### Step 12 Validation

**After updating `plan.md`, verify:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>plan = read("01-planning/plan.md")

assert "## Orchestrator Instructions" in plan, "Missing orchestrator section"
assert "## Subagent Allocation Plan" in plan, "Missing allocation plan"
assert "| Paper ID | Chunks |" in plan, "Missing allocation table"
assert "**Total subagents**:" in plan, "Missing subagent count"
assert "### Constants" in plan, "Missing constants"
assert "### Phase 4: Paper Analysis" in plan, "Missing Phase 4"
assert "### Phase 4.5: Validation" in plan, "Missing Phase 4.5"
assert "{paper_id}" in plan, "Missing paper_id variable in template"

# Verify allocation count matches paper count
paper_count = count_papers_with_metadata_json()
allocation_rows = count_table_rows("## Subagent Allocation Plan")
assert allocation_rows == paper_count, f"Allocation mismatch: {allocation_rows} vs {paper_count} papers"</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Subagent Allocation Plan</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Paper ID</th>
                                                <th>Chunks</th>
                                                <th>Est. Tokens</th>
                                                <th>Subagents</th>
                                                <th>Splits</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Small_Paper</td>
                                                <td>3</td>
                                                <td>~35,000</td>
                                                <td>1</td>
                                                <td>1-3</td>
                                            </tr>
                                            <tr>
                                                <td>Medium_Paper</td>
                                                <td>6</td>
                                                <td>~70,000</td>
                                                <td>1</td>
                                                <td>1-6</td>
                                            </tr>
                                            <tr>
                                                <td>Large_Paper</td>
                                                <td>10</td>
                                                <td>~120,000</td>
                                                <td>2</td>
                                                <td>1-6, 7-10</td>
                                            </tr>
                                            <tr>
                                                <td>Survey_Paper</td>
                                                <td>16</td>
                                                <td>~190,000</td>
                                                <td>3</td>
                                                <td>1-6, 7-12, 13-16</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">12</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            be written to plan.md so execute-research-project can read it:**
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            **
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Orchestrator Instructions" in plan, "Missing orchestrator section"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "## Subagent Allocation Plan" in plan, "Missing allocation plan"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "| Paper ID | Chunks |" in plan, "Missing allocation table"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "**Total subagents**:" in plan, "Missing subagent count"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "### Constants" in plan, "Missing constants"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "### Phase 4: Paper Analysis" in plan, "Missing Phase 4"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "### Phase 4.5: Validation" in plan, "Missing Phase 4.5"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            "{paper_id}" in plan, "Missing paper_id variable in template"
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            allocation count matches paper count
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            allocation_rows == paper_count, f"Allocation mismatch: {allocation_rows} vs {paper_count} papers"
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>ü§ñ Subagent Configuration</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="subagent-config">
                                    <p style="color: var(--text-secondary); margin-bottom: 0.75rem;"></p>
                                    <div class="config-grid">
                                        <div class="config-item">
                                            <span class="config-label">Model</span>
                                            <span class="config-value">sonnet</span>
                                        </div>
                                        <div class="config-item">
                                            <span class="config-label">Timeout</span>
                                            <span class="config-value">5 min</span>
                                        </div>
                                        <div class="config-item">
                                            <span class="config-label">Budget</span>
                                            <span class="config-value">74k</span>
                                        </div>
                                        <div class="config-item">
                                            <span class="config-label">Concurrency</span>
                                            <span class="config-value">15</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-13">
                        <div class="step-header">
                            <div class="step-number">13</div>
                            <div class="step-title">
                                <h4>Confirm Ready for Execution</h4>
                                <div class="step-meta">Phase D ¬∑ create-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Final verification before handoff: When Readiness Gate passes: The `execute-research-project` skill expects: Paper folders with `_metadata.json` (chunks exist) `02-resources/_briefing.md` (extraction schema) `02-resources/_analysis_kit.md` (subagent context) `02-resources/_extraction_guide.md` (field examples + vocabulary) `01-planning/plan.md` with `## Orchestrator Instructions` section `01-planning/steps.md` (batch tracking) `overview.md` with `status: READY_FOR_EXECUTION` execute-research-project will: 1. Validate all prerequisites exist (fail fast if missing) 2. Read orchestrator instructions from plan.md 3. Spawn analysis subagents in batches (max 10 parallel) 4. Validate each batch (Phase 4.5 - hallucination check) 5. Retry failed papers 6. Generate synthesis 7. Mark project COMPLETE...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">11</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Analyze each paper (spawn subagents in batches of 10)</li>
                                    <li class="substep-item">Validate analysis logs (Phase 4.5 hallucination check)</li>
                                    <li class="substep-item">Retry failed papers</li>
                                    <li class="substep-item">Generate cross-paper synthesis</li>
                                    <li class="substep-item">Validate all prerequisites exist (fail fast if missing)</li>
                                    <li class="substep-item">Read orchestrator instructions from plan.md</li>
                                    <li class="substep-item">Spawn analysis subagents in batches (max 10 parallel)</li>
                                    <li class="substep-item">Validate each batch (Phase 4.5 - hallucination check)</li>
                                    <li class="substep-item">Retry failed papers</li>
                                    <li class="substep-item">Generate synthesis</li>
                                    <li class="substep-item">Mark project COMPLETE</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Final verification before handoff:**

### Readiness Checks</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># 1. Verify at least 1 paper has chunks
papers_with_chunks = count_papers_with_metadata_json()
if papers_with_chunks == 0:
    fail("No papers preprocessed - cannot proceed")

# 2. Verify briefing exists
if not exists("02-resources/_briefing.md"):
    fail("Missing _briefing.md - research question not defined")

# 3. Verify analysis kit exists
if not exists("02-resources/_analysis_kit.md"):
    fail("Missing _analysis_kit.md - run Step 10")

# 4. Verify extraction guide exists
if not exists("02-resources/_extraction_guide.md"):
    fail("Missing _extraction_guide.md - run Step 11")

# 5. Verify orchestrator instructions in plan.md
if "## Orchestrator Instructions" not in read("01-planning/plan.md"):
    fail("Missing orchestrator instructions - run Step 12")

# 6. Update overview.md
update_overview(status="READY_FOR_EXECUTION")</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>Update overview.md
update_overview(status="READY_FOR_EXECUTION")
```

### Final Summary</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
PLANNING COMPLETE - READY FOR EXECUTION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Research Project: {name}
Research Question: "{RQ}"

Papers ready: {N} ({chunks} chunks)
Papers unavailable: {M}

All prerequisites met:
  ‚úì _briefing.md (extraction schema)
  ‚úì _analysis_kit.md (subagent context)
  ‚úì _selection_log.md (user approved)
  ‚úì Paper chunks ({N} papers preprocessed)
  ‚úì plan.md (orchestrator instructions)
  ‚úì steps.md (batch tracking)

To start analysis, say:
  "execute research project {name}"

This will:
  1. Analyze each paper (spawn subagents in batches of 10)
  2. Validate analysis logs (Phase 4.5 hallucination check)
  3. Retry failed papers
  4. Generate cross-paper synthesis
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>## Files Created by This Skill</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>File</th>
                                                <th>Location</th>
                                                <th>Purpose</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>`_briefing.md`</td>
                                                <td>02-resources/</td>
                                                <td>Extraction schema</td>
                                            </tr>
                                            <tr>
                                                <td>`_analysis_kit.md`</td>
                                                <td>02-resources/</td>
                                                <td>Subagent context (Step 10)</td>
                                            </tr>
                                            <tr>
                                                <td>`_extraction_guide.md`</td>
                                                <td>02-resources/</td>
                                                <td>Field examples + vocabulary (Step 11)</td>
                                            </tr>
                                            <tr>
                                                <td>`_search_results.md`</td>
                                                <td>02-resources/</td>
                                                <td>API results</td>
                                            </tr>
                                            <tr>
                                                <td>`_abstract_reviews.md`</td>
                                                <td>02-resources/</td>
                                                <td>AI assessments</td>
                                            </tr>
                                            <tr>
                                                <td>`_selection_log.md`</td>
                                                <td>03-working/</td>
                                                <td>Approved papers + acquisition status</td>
                                            </tr>
                                            <tr>
                                                <td>`*.pdf`</td>
                                                <td>02-resources/papers/{paper}/</td>
                                                <td>Downloaded papers</td>
                                            </tr>
                                            <tr>
                                                <td>`*_N.md`</td>
                                                <td>02-resources/papers/{paper}/</td>
                                                <td>Markdown chunks</td>
                                            </tr>
                                            <tr>
                                                <td>`_metadata.json`</td>
                                                <td>02-resources/papers/{paper}/</td>
                                                <td>Chunk index</td>
                                            </tr>
                                            <tr>
                                                <td>`plan.md`</td>
                                                <td>01-planning/</td>
                                                <td>Orchestrator instructions (Step 12)</td>
                                            </tr>
                                            <tr>
                                                <td>`steps.md`</td>
                                                <td>01-planning/</td>
                                                <td>Batch tracking</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Error Handling</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Step</th>
                                                <th>Error</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>API rate limit</td>
                                                <td>Wait and retry, or use cached results</td>
                                            </tr>
                                            <tr>
                                                <td>Step 7</td>
                                                <td>Download fails</td>
                                                <td>Try alternative source ‚Üí Mark unavailable</td>
                                            </tr>
                                            <tr>
                                                <td>Step 7</td>
                                                <td>All papers paywalled</td>
                                                <td>Warn user, suggest arXiv alternatives</td>
                                            </tr>
                                            <tr>
                                                <td>Step 8</td>
                                                <td>PDF corrupted</td>
                                                <td>Skip paper, log error</td>
                                            </tr>
                                            <tr>
                                                <td>Step 8</td>
                                                <td>pymupdf4llm fails</td>
                                                <td>Try alternative extraction, or skip</td>
                                            </tr>
                                            <tr>
                                                <td>Step 9</td>
                                                <td><50% acquired</td>
                                                <td>Warn, offer to search alternatives</td>
                                            </tr>
                                            <tr>
                                                <td>Step 10</td>
                                                <td>Missing _briefing.md</td>
                                                <td>Go back to Step 2</td>
                                            </tr>
                                            <tr>
                                                <td>Step 10</td>
                                                <td>Validation fails</td>
                                                <td>Regenerate _analysis_kit.md</td>
                                            </tr>
                                            <tr>
                                                <td>Step 11</td>
                                                <td>Field count mismatch</td>
                                                <td>Add missing field definitions</td>
                                            </tr>
                                            <tr>
                                                <td>Step 12</td>
                                                <td>Missing sections</td>
                                                <td>Add missing orchestrator sections</td>
                                            </tr>
                                            <tr>
                                                <td>Step 13</td>
                                                <td>0 papers ready</td>
                                                <td>Block handoff, must retry acquisition</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">7</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            retry acquisition |
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            at least 1 paper has chunks
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            briefing exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            analysis kit exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            extraction guide exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            orchestrator instructions in plan.md
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            all new files
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Error Handlers</span>
                                    <span class="content-badge">11</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="error-handler">
                                    <div class="error-type">API rate limit</div>
                                    <div class="error-solution">Wait and retry, or use cached results</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Download fails</div>
                                    <div class="error-solution">Try alternative source ‚Üí Mark unavailable</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">All papers paywalled</div>
                                    <div class="error-solution">Warn user, suggest arXiv alternatives</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">PDF corrupted</div>
                                    <div class="error-solution">Skip paper, log error</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">pymupdf4llm fails</div>
                                    <div class="error-solution">Try alternative extraction, or skip</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type"><50% acquired</div>
                                    <div class="error-solution">Warn, offer to search alternatives</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Missing _briefing.md</div>
                                    <div class="error-solution">Go back to Step 2</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Validation fails</div>
                                    <div class="error-solution">Regenerate _analysis_kit.md</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Field count mismatch</div>
                                    <div class="error-solution">Add missing field definitions</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Missing sections</div>
                                    <div class="error-solution">Add missing orchestrator sections</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">0 papers ready</div>
                                    <div class="error-solution">Block handoff, must retry acquisition</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="skill-section" id="skill-analyze-research-project">
                <div class="skill-header">
                    <h2>analyze-research-project</h2>
                    <p>Analyze research papers (Phase 2: analysis only). Load when user says 'analyze research project', 'execute research project', 'continue research', 'run analysis', or mentions a research project by name after planning is complete. Expects analysis-ready chunks from create-research-project. After analysis, use synthesize-research-project for synthesis.</p>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase A: VALIDATION</h3>
                    </div>
                    <div class="step-card" id="step-0">
                        <div class="step-header">
                            <div class="step-number">0</div>
                            <div class="step-title">
                                <h4>Initialize Task Tracking</h4>
                                <div class="step-meta">Phase ? ¬∑ analyze-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            MANDATORY: Use TodoWrite at start of skill: Update todos as each step completes. At start of execution, read `01-planning/plan.md` for: Paper Corpus table (which papers to analyze) Subagent allocation rules (how many subagents per paper) Orchestrator Instructions (exact prompts for subagents) Current State (to update as execution progresses) Use the prompts in plan.md "Orchestrator Instructions" section for spawning subagents. After completing each step, mark the corresponding checkbox in `01-planning/steps.md`: | After Step | Mark Complete in steps.md | |------------|---------------------------| | Step 2 | `- [x] Analyze papers with subagents` | | Step 3 | `- [x] Validate analysis logs` | | Step 4 | `- [x] Mark analysis ready for synthesis` | Use Edit tool to change `- [ ]` to `- [x]` for...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**MANDATORY: Use TodoWrite at start of skill:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>TodoWrite with initial todos:
- [ ] Validate readiness (Step 1)
- [ ] Analyze papers ‚Üí index.md + _analysis_log.md (Step 2)
- [ ] Validate analysis logs (Step 3)
- [ ] Mark analysis READY_FOR_SYNTHESIS (Step 4)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>`- [x] Mark analysis ready for synthesis` |

**Use Edit tool to change `- [ ]` to `- [x]` for each completed task.**

### Updating plan.md Current State

**After Step 2 (Analysis)**, update plan.md:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Current State

| Metric | Value |
|--------|-------|
| Phase | 4-Analysis (complete) |
| Papers Approved | 25 |
| Papers Downloaded | 18 |
| Papers with Chunks | 18 |
| Papers Analyzed | 17 |
| Total Chunks | 52 |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>per Corpus table status column:**
- Change `ready` to `analyzed` for each completed paper
- Change to `failed` for papers that failed validation

**After Step 4 (Analysis Complete)**, update plan.md:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Current State

| Metric | Value |
|--------|-------|
| Phase | READY_FOR_SYNTHESIS |
| Papers Approved | 25 |
| Papers Downloaded | 18 |
| Papers with Chunks | 18 |
| Papers Analyzed | 17 |
| Total Chunks | 52 |</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>**After completing each step, mark the corresponding checkbox in `01-planning/steps.md`:**</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>After Step</th>
                                                <th>Mark Complete in steps.md</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Step 2</td>
                                                <td>`- [x] Analyze papers with subagents`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>`- [x] Validate analysis logs`</td>
                                            </tr>
                                            <tr>
                                                <td>Step 4</td>
                                                <td>`- [x] Mark analysis ready for synthesis`</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Current State</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Phase</td>
                                                <td>4-Analysis (complete)</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Approved</td>
                                                <td>25</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Downloaded</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers with Chunks</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Analyzed</td>
                                                <td>17</td>
                                            </tr>
                                            <tr>
                                                <td>Total Chunks</td>
                                                <td>52</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Current State</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Phase</td>
                                                <td>READY_FOR_SYNTHESIS</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Approved</td>
                                                <td>25</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Downloaded</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers with Chunks</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Analyzed</td>
                                                <td>17</td>
                                            </tr>
                                            <tr>
                                                <td>Total Chunks</td>
                                                <td>52</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-blue); margin-bottom: 0.5rem;">Inputs</h5>
                                <div class="file-list">
                                    <div class="file-ref input" title="">01-planning/plan.md</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">
                                <h4>Validate Readiness</h4>
                                <div class="step-meta">Phase A ¬∑ analyze-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Check prerequisites and paper readiness: If project was created with an older version (missing _analysis_kit.md, _extraction_guide.md, or orchestrator instructions): The allocation was calculated in Phase 1 Step 12. READ it from plan.md - DO NOT recalculate! CRITICAL: The allocation is pre-calculated in Phase 1 Step 12. Do NOT modify or recalculate here. If allocation seems wrong, go back to Phase 1 and regenerate.
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Generate _analysis_kit.md (Step 10)</li>
                                    <li class="substep-item">Generate _extraction_guide.md (Step 11)</li>
                                    <li class="substep-item">Add orchestrator instructions to plan.md (Step 12)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">7</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Check prerequisites and paper readiness:**

### 1.1 Prerequisite Checks (Fail Fast)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>project_path = "02-projects/NN-{slug}/"

# Check briefing exists
if not exists(project_path / "02-resources/_briefing.md"):
    fail("""
    Missing _briefing.md - research question not defined.
    Run 'create research project' Step 2 first.
    """)

# Check analysis kit exists
if not exists(project_path / "02-resources/_analysis_kit.md"):
    fail("""
    Missing _analysis_kit.md - subagent context not generated.
    Run 'create research project' Step 10 first.
    """)

# Check extraction guide exists
if not exists(project_path / "02-resources/_extraction_guide.md"):
    fail("""
    Missing _extraction_guide.md - field examples not defined.
    Run 'create research project' Step 11 first.
    """)

# Check orchestrator instructions in plan.md
plan = read(project_path / "01-planning/plan.md")
if "## Orchestrator Instructions" not in plan:
    fail("""
    Missing orchestrator instructions in plan.md.
    Run 'create research project' Step 12 first.
    """)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>""")
```

### 1.2 Paper Readiness Check</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Find papers with chunks (have _metadata.json)
papers_ready = []
for folder in (project_path / "02-resources/papers").iterdir():
    if folder.is_dir() and (folder / "_metadata.json").exists():
        papers_ready.append(folder.name)

if len(papers_ready) == 0:
    fail("No papers preprocessed - run create-research-project first")

# Check for papers needing analysis (no index.md yet)
papers_to_analyze = []
for paper in papers_ready:
    if not (project_path / f"02-resources/papers/{paper}/index.md").exists():
        papers_to_analyze.append(paper)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>papers_to_analyze.append(paper)
```

### Legacy Compatibility Check

If project was created with an older version (missing _analysis_kit.md, _extraction_guide.md, or orchestrator instructions):</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>This project was created with an older version.
Missing prerequisite files must be generated first.

Run these commands to complete setup:
  1. Generate _analysis_kit.md (Step 10)
  2. Generate _extraction_guide.md (Step 11)
  3. Add orchestrator instructions to plan.md (Step 12)

Or re-run: "create research project {name}" to regenerate.</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>```

### Display Status</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
RESEARCH PROJECT READY FOR EXECUTION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Research Project: {name}
Research Question: "{RQ}"

Papers ready:     {N} (with chunks)
Papers to analyze: {M} (no index.md yet)
Already analyzed:  {K} (have index.md)

Briefing: _briefing.md ‚úì

Proceeding with Phase 2 (Analysis)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>READ it from plan.md - DO NOT recalculate!**

### Read Allocation Table from plan.md</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Read the pre-calculated allocation from plan.md
plan = read(f"{project_path}/01-planning/plan.md")

# Parse the "## Subagent Allocation Plan" section
allocation_table = parse_markdown_table(plan, "## Subagent Allocation Plan")

# Expected format:
# | Paper ID | Chunks | Est. Tokens | Subagents | Splits |
# |----------|--------|-------------|-----------|--------|
# | Paper_A  | 4      | ~47,000     | 1         | 1-4    |
# | Paper_B  | 10     | ~120,000    | 2         | 1-6, 7-10 |

total_subagents = extract_value(plan, "**Total subagents**:")</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>| ~47,000     | 1         | 1-4    |
# | Paper_B  | 10     | ~120,000    | 2         | 1-6, 7-10 |

total_subagents = extract_value(plan, "**Total subagents**:")
```

### Verify Allocation Exists</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>if "## Subagent Allocation Plan" not in plan:
    fail("""
    Missing subagent allocation plan in plan.md.
    This should have been created in Phase 1 Step 12.
    Run 'create research project' Step 12 to generate allocation.
    """)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>""")
```

### Display Pre-Calculated Plan</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SUBAGENT ALLOCATION (from plan.md)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

| Paper | Chunks | Est. Tokens | Subagents | Splits |
|-------|--------|-------------|-----------|--------|
| Small_Paper | 3 | ~35,000 | 1 | 1-3 |
| Medium_Paper | 6 | ~70,000 | 1 | 1-6 |
| Large_Paper | 10 | ~120,000 | 2 | 1-6, 7-10 |
| Survey_Paper | 16 | ~190,000 | 3 | 1-6, 7-12, 13-16 |

Total subagents: 7
Max concurrent: 15
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Proceeding with pre-planned allocation...</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>SUBAGENT ALLOCATION (from plan.md)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Paper</th>
                                                <th>Chunks</th>
                                                <th>Est. Tokens</th>
                                                <th>Subagents</th>
                                                <th>Splits</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Small_Paper</td>
                                                <td>3</td>
                                                <td>~35,000</td>
                                                <td>1</td>
                                                <td>1-3</td>
                                            </tr>
                                            <tr>
                                                <td>Medium_Paper</td>
                                                <td>6</td>
                                                <td>~70,000</td>
                                                <td>1</td>
                                                <td>1-6</td>
                                            </tr>
                                            <tr>
                                                <td>Large_Paper</td>
                                                <td>10</td>
                                                <td>~120,000</td>
                                                <td>2</td>
                                                <td>1-6, 7-10</td>
                                            </tr>
                                            <tr>
                                                <td>Survey_Paper</td>
                                                <td>16</td>
                                                <td>~190,000</td>
                                                <td>3</td>
                                                <td>1-6, 7-12, 13-16</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">11</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            be generated first.
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            prerequisites and paper readiness:**
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            briefing exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            analysis kit exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            extraction guide exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            orchestrator instructions in plan.md
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            ```python
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            for papers needing analysis (no index.md yet)
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            If project was created with an older version (missing _analysis_kit.md, _extraction_guide.md, or orchestrator instructions):
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            Allocation Exists
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">should</span>
                                            have been created in Phase 1 Step 12.
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Error Handlers</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="error-handler">
                                    <div class="error-type">project was created with an older version (missing _analysis_kit.md</div>
                                    <div class="error-solution">_extraction_guide</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase B: ANALYSIS</h3>
                    </div>
                    <div class="step-card" id="step-2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">
                                <h4>Analyze Papers</h4>
                                <div class="step-meta">Phase B ¬∑ analyze-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Read plan.md "Orchestrator Instructions" section for subagent prompts. The plan.md contains: Paper Corpus table with chunk counts and subagent allocation Exact prompts for standard papers (1 subagent) Exact prompts for large papers (2+ subagents + merge) Concurrency settings Each subagent receives explicit file access rules in its prompt: Include this INPUT CONTRACT in every subagent prompt. For each row in the Subagent Allocation Plan table: 1. Read the `Subagents` column (pre-calculated count) 2. Read the `Splits` column (pre-calculated chunk ranges) 3. If `Subagents == 1` ‚Üí Spawn single subagent for all chunks 4. If `Subagents > 1` ‚Üí Spawn one subagent per split range, then spawn merge subagent Example: Large_Paper with Subagents=2, Splits="1-6, 7-10" CRITICAL: Follow the pre-calculated...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">18</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">`03-skills/research-pipeline/shared/paper-analyze-core/SKILL.md` (methodology)</li>
                                    <li class="substep-item">`{project_path}/02-resources/_briefing.md` (research question + schema)</li>
                                    <li class="substep-item">`{project_path}/02-resources/_analysis_kit.md` (subagent context)</li>
                                    <li class="substep-item">`{project_path}/02-resources/_extraction_guide.md` (field examples + vocabulary)</li>
                                    <li class="substep-item">`{paper_path}/_metadata.json` (chunk info)</li>
                                    <li class="substep-item">`{paper_path}/{paper_id}_1.md`</li>
                                    <li class="substep-item">`{paper_path}/{paper_id}_2.md`</li>
                                    <li class="substep-item">Read the `Subagents` column (pre-calculated count)</li>
                                    <li class="substep-item">Read the `Splits` column (pre-calculated chunk ranges)</li>
                                    <li class="substep-item">If `Subagents == 1` ‚Üí Spawn single subagent for all chunks</li>
                                    <li class="substep-item">If `Subagents > 1` ‚Üí Spawn one subagent per split range, then spawn merge subagent</li>
                                    <li class="substep-item">Read files IN ORDER listed in INPUT CONTRACT</li>
                                    <li class="substep-item">For EVERY chunk, assess EVERY field: true/partial/false (see Step 1b calibration)</li>
                                    <li class="substep-item">Extract items only for true/partial fields</li>
                                    <li class="substep-item">Record evidence (start + end) for each chunk</li>
                                    <li class="substep-item">Use Structured N/A format for fields not found (Gap G18)</li>
                                    <li class="substep-item">`{paper_path}/_analysis_log.md` (Schema v2.3)</li>
                                    <li class="substep-item">`{paper_path}/index.md` (MUST use YAML frontmatter format below)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">7</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>Exact prompts for large papers (2+ subagents + merge)
- Concurrency settings

### SUBAGENT INPUT CONTRACT (STRICT - Gap G13 Fix)

**Each subagent receives explicit file access rules in its prompt:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## INPUT CONTRACT (STRICT)

### Files You MUST Read (in this order)
1. `03-skills/research-pipeline/shared/paper-analyze-core/SKILL.md` (methodology)
2. `{project_path}/02-resources/_briefing.md` (research question + schema)
3. `{project_path}/02-resources/_analysis_kit.md` (subagent context)
4. `{project_path}/02-resources/_extraction_guide.md` (field examples + vocabulary)
5. `{paper_path}/_metadata.json` (chunk info)
6. `{paper_path}/{paper_id}_1.md`
7. `{paper_path}/{paper_id}_2.md`
[... exact chunk list from _metadata.json]

### Files You MUST NOT Read
- ANY `.pdf` file
- ANY folder except `{paper_path}/`
- ANY file in `04-outputs/`
- ANY other paper folder in `02-resources/papers/`
- ANY file starting with `.` (hidden files)
- ANY file outside project directory

### Directory Traversal FORBIDDEN
- Do NOT use `../` paths
- Do NOT follow symbolic links
- Stay within `{project_path}/` boundary

VIOLATION = Analysis fails validation.</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>If `Subagents > 1` ‚Üí Spawn one subagent per split range, then spawn merge subagent

**Example: Large_Paper with Subagents=2, Splits="1-6, 7-10"**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Spawn Task 1: Analyze chunks 1-6 ‚Üí index_part1.md
Spawn Task 2: Analyze chunks 7-10 ‚Üí index_part2.md
Wait for both...
Spawn Merge Task: Combine index_part1.md + index_part2.md ‚Üí index.md</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**SUBAGENT PROMPT TEMPLATE (with G22a, G22b context):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Task(
  subagent_type="general-purpose",
  prompt=f"""
## Paper Analysis Task: {paper_id}

## INPUT CONTRACT (STRICT)
{INPUT_CONTRACT_TEXT}  # See above

## CONTEXT
Research Purpose: {research_purpose}  # G22a - WHY this research matters
Synthesis Goals: {synthesis_goals}    # G22b - What synthesis will aggregate

## PROCESSING CONTRACT
1. Read files IN ORDER listed in INPUT CONTRACT
2. For EVERY chunk, assess EVERY field: true/partial/false (see Step 1b calibration)
3. Extract items only for true/partial fields
4. Record evidence (start + end) for each chunk
5. Use Structured N/A format for fields not found (Gap G18)

## OUTPUT CONTRACT
Write these files:
1. `{paper_path}/_analysis_log.md` (Schema v2.3)
2. `{paper_path}/index.md` (MUST use YAML frontmatter format below)

### CRITICAL: index.md MUST use this EXACT YAML frontmatter structure:</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>chunk..."

# Use Structured N/A for fields not found
{field_name_not_found}:
  - item: "NOT_FOUND"
    chunk: null
    lines: null
    quote: null
    reason: "Paper does not discuss this topic"
---</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>### fields_found template (generate from _briefing.md extraction_schema):</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>ALL fields from extraction_schema MUST be listed
      # true = extractable content present
      # partial = mentioned but not detailed
      # false = not present in chunk</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>**VALIDATION**: Synthesis pipeline will FAIL if chunk_index is missing or malformed.

Do NOT read other files. Do NOT read the PDF.
"""
)</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>above

### Concurrency Settings

- **Max concurrent subagents**: 15 (parallel analysis for speed)
- **Timeout per paper**: 5 minutes
- **Retry on failure**: 1 attempt

### Subagent Outputs Per Paper</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>02-resources/{paper}/
‚îú‚îÄ‚îÄ {paper}.pdf           # Original (unchanged)
‚îú‚îÄ‚îÄ {paper}_1.md          # Chunk 1 (unchanged)
‚îú‚îÄ‚îÄ {paper}_2.md          # Chunk 2 (unchanged)
‚îú‚îÄ‚îÄ _metadata.json        # Chunk index (unchanged)
‚îú‚îÄ‚îÄ _analysis_log.md      # NEW: Schema v2.0 validation log
‚îî‚îÄ‚îÄ index.md              # NEW: Analysis output</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>(unchanged)
‚îú‚îÄ‚îÄ _metadata.json        # Chunk index (unchanged)
‚îú‚îÄ‚îÄ _analysis_log.md      # NEW: Schema v2.0 validation log
‚îî‚îÄ‚îÄ index.md              # NEW: Analysis output
```

### Progress Display</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Analyzing papers...
  [1/18] Auto_TA... COMPLETE (4 chunks, 2.3 min)
  [2/18] SFT_TA... COMPLETE (3 chunks, 1.8 min)
  [3/18] De_Paoli... IN_PROGRESS...
  ...

Analyzed: 15/18 papers
In progress: 3
Failed: 0</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">6</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            Read (in this order)
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            NOT Read
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            use YAML frontmatter format below)
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            index.md MUST use this EXACT YAML frontmatter structure:
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            equal chunks_expected}
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            be listed
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-blue); margin-bottom: 0.5rem;">Inputs</h5>
                                <div class="file-list">
                                    <div class="file-ref input" title="">03-skills/research-pipeline/shared/paper-analyze-core/SKILL.md</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Gap Fixes</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">G13</span>
                                        <span class="gap-description">Fix)</span>
                                    </div>
                                    <div class="gap-context">r large papers (2+ subagents + merge)
- Concurrency settings

### SUBAGENT INPUT CONTRACT (STRICT - Gap G13 Fix)

**Each subagent receives explicit file access rules in its prompt:**

```markdown
## INPUT CONTRACT (STRICT)

### Files You MUST Read (in this order)
1. `03-skills/research-pipeline/shar</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">22B</span>
                                        <span class="gap-description">context):**</span>
                                    </div>
                                    <div class="gap-context">ed allocation EXACTLY. Do NOT recalculate or modify splits.

**SUBAGENT PROMPT TEMPLATE (with G22a, G22b context):**

```python
Task(
  subagent_type="general-purpose",
  prompt=f"""
## Paper Analysis Task: {paper_id}

## INPUT CONTRACT (STRICT)
{INPUT_CONTRACT_TEXT}  # See above

## CONTEXT
Researc</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">22A</span>
                                        <span class="gap-description">- WHY this research matters</span>
                                    </div>
                                    <div class="gap-context">ACT (STRICT)
{INPUT_CONTRACT_TEXT}  # See above

## CONTEXT
Research Purpose: {research_purpose}  # G22a - WHY this research matters
Synthesis Goals: {synthesis_goals}    # G22b - What synthesis will aggregate

## PROCESSING CONTRACT
1. Read files IN ORDER listed in INPUT CONTRACT
2. For EVERY chunk</div>
                                </div>
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">22B</span>
                                        <span class="gap-description">- What synthesis will aggregate</span>
                                    </div>
                                    <div class="gap-context">ose: {research_purpose}  # G22a - WHY this research matters
Synthesis Goals: {synthesis_goals}    # G22b - What synthesis will aggregate

## PROCESSING CONTRACT
1. Read files IN ORDER listed in INPUT CONTRACT
2. For EVERY chunk, assess EVERY field: true/partial/false (see Step 1b calibration)
3. Ext</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">
                                <h4>Validate Analysis Logs</h4>
                                <div class="step-meta">Phase B ¬∑ analyze-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run validation on each completed analysis: 1. Schema version = 2.0 2. All steps completed 3. All chunks read (recorded in log) 4. Multi-point evidence matches actual chunks 5. index.md created and valid YAML frontmatter | User Input | Action | |------------|--------| | **Y** | Respawn subagent for failed papers (1 retry) | | **N** | Exclude from synthesis, note in report | If still failing after retry:
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Schema version = 2.0</li>
                                    <li class="substep-item">All steps completed</li>
                                    <li class="substep-item">All chunks read (recorded in log)</li>
                                    <li class="substep-item">Multi-point evidence matches actual chunks</li>
                                    <li class="substep-item">index.md created and valid YAML frontmatter</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run validation on each completed analysis:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/skills/paper-analyze/scripts/validate_analysis.py \
  02-projects/NN-{slug}/02-resources/ \
  --output 04-outputs/_validation_report.md</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>index.md created and valid YAML frontmatter

### Validation Results Display</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
VALIDATION RESULTS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚úì PASSED:  16 papers (validation complete)
‚ö† WARNING: 1 paper (minor issues, usable)
‚úó FAILED:  1 paper (evidence mismatch)

Failed papers:
  ‚Ä¢ Paper_XYZ - Chunk 3 evidence mismatch

Re-analyze failed papers? [Y/N]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>er Input | Action |
|------------|--------|
| **Y** | Respawn subagent for failed papers (1 retry) |
| **N** | Exclude from synthesis, note in report |

### After Retry

If still failing after retry:</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Paper_XYZ failed validation after retry.
Excluding from synthesis. See _validation_report.md for details.

Continue with {N} validated papers? [Y/N]</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>### Handle Failures</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>User Input</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>**Y**</td>
                                                <td>Respawn subagent for failed papers (1 retry)</td>
                                            </tr>
                                            <tr>
                                                <td>**N**</td>
                                                <td>Exclude from synthesis, note in report</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/skills/paper-analyze/scripts/validate_analysis.py</span>
                                    </div>
                                    
                                    <div class="script-command"><code>python 03-skills/research-pipeline/skills/paper-analyze/scripts/validate_analysis.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase C: COMPLETION</h3>
                    </div>
                    <div class="step-card" id="step-4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">
                                <h4>Mark Analysis READY_FOR_SYNTHESIS</h4>
                                <div class="step-meta">Phase C ¬∑ analyze-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Update project status to indicate readiness for synthesis: | File | Location | Purpose | |------|----------|---------| | `_analysis_log.md` | 02-resources/papers/{paper}/ | Validation log (v2.0) | | `index.md` | 02-resources/papers/{paper}/ | Analysis output with YAML frontmatter | | `_validation_report.md` | 04-outputs/ | Analysis validation results | Note: Synthesis files are created by `synthesize-research-project` (Phase 3). | Step | Error | Action | |------|-------|--------| | Step 1 | No chunks found | Redirect to create-research-project | | Step 1 | No _briefing.md | Fail with clear message | | Step 2 | Subagent fails | Retry once, then mark failed | | Step 2 | Subagent timeout | **PARTIAL SAVE** (see below) | | Step 3 | Evidence mismatch | Offer re-analysis or exclusion | | Step 3 ...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads `chunks_remaining` from `_analysis_log.md`</li>
                                    <li class="substep-item">Spawns subagent with `start_from_chunk: 4`</li>
                                    <li class="substep-item">Subagent appends to existing index.md</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>**Update project status to indicate readiness for synthesis:**

### Update overview.md</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># overview.md
status: READY_FOR_SYNTHESIS
analysis_completed_at: "{timestamp}"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>ct status to indicate readiness for synthesis:**

### Update overview.md

```yaml
# overview.md
status: READY_FOR_SYNTHESIS
analysis_completed_at: "{timestamp}"
```

### Update plan.md Current State</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## Current State

| Metric | Value |
|--------|-------|
| Phase | READY_FOR_SYNTHESIS |
| Papers Analyzed | 17 |
| Papers Validated | 16 |
| Total Chunks | 52 |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>e

```markdown
## Current State

| Metric | Value |
|--------|-------|
| Phase | READY_FOR_SYNTHESIS |
| Papers Analyzed | 17 |
| Papers Validated | 16 |
| Total Chunks | 52 |
```

### Final Summary</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ANALYSIS COMPLETE - READY FOR SYNTHESIS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Project: {name}
Research Question: "{RQ}"

Papers analyzed: 17/18
Validation rate: 94%

Outputs:
  üìã 04-outputs/_validation_report.md (analysis validation)

Per-paper analysis:
  üìÅ 02-resources/{paper}/index.md (17 papers)

NEXT STEP:
  Run "synthesize research project {name}" to generate synthesis report.

  This will:
  ‚Ä¢ Read all index.md files
  ‚Ä¢ Spawn batch extraction subagents
  ‚Ä¢ Aggregate patterns per field
  ‚Ä¢ Generate full _synthesis_report.md with citations

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Warn, proceed with caution |
| Step 4 | 0 papers validated | Fail - nothing to analyze |

### Timeout Partial Save Protocol (Gap G16)

**When timeout occurs, subagent MUST write partial progress:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># In _analysis_log.md when timeout occurs:
error_handling:
  timeout_occurred: true
  partial_success: true
  chunks_completed: [1, 2, 3]  # Which chunks were fully analyzed
  chunks_remaining: [4, 5]     # Which chunks need re-analysis
  recovery_notes: "Resume from chunk 4. Chunks 1-3 have complete extractions."

# In index.md - include partial chunk_index:
chunk_index:
  1: {token_count: ..., hash: ..., fields_found: {...}}
  2: {token_count: ..., hash: ..., fields_found: {...}}
  3: {token_count: ..., hash: ..., fields_found: {...}}
  # 4, 5 missing - will be added on resume</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>Subagent appends to existing index.md

**Resume prompt addition:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>## RESUME MODE
Partial analysis exists. Read existing:
- `{paper_path}/_analysis_log.md` - check `chunks_completed`
- `{paper_path}/index.md` - has partial chunk_index

Start analysis from chunk {start_from_chunk}.
APPEND to existing chunk_index (don't overwrite).</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>```markdown
## Current State</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Phase</td>
                                                <td>READY_FOR_SYNTHESIS</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Analyzed</td>
                                                <td>17</td>
                                            </tr>
                                            <tr>
                                                <td>Papers Validated</td>
                                                <td>16</td>
                                            </tr>
                                            <tr>
                                                <td>Total Chunks</td>
                                                <td>52</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Files Created by This Skill</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>File</th>
                                                <th>Location</th>
                                                <th>Purpose</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>`_analysis_log.md`</td>
                                                <td>02-resources/papers/{paper}/</td>
                                                <td>Validation log (v2.0)</td>
                                            </tr>
                                            <tr>
                                                <td>`index.md`</td>
                                                <td>02-resources/papers/{paper}/</td>
                                                <td>Analysis output with YAML frontmatter</td>
                                            </tr>
                                            <tr>
                                                <td>`_validation_report.md`</td>
                                                <td>04-outputs/</td>
                                                <td>Analysis validation results</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Error Handling</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Step</th>
                                                <th>Error</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Step 1</td>
                                                <td>No chunks found</td>
                                                <td>Redirect to create-research-project</td>
                                            </tr>
                                            <tr>
                                                <td>Step 1</td>
                                                <td>No _briefing.md</td>
                                                <td>Fail with clear message</td>
                                            </tr>
                                            <tr>
                                                <td>Step 2</td>
                                                <td>Subagent fails</td>
                                                <td>Retry once, then mark failed</td>
                                            </tr>
                                            <tr>
                                                <td>Step 2</td>
                                                <td>Subagent timeout</td>
                                                <td>**PARTIAL SAVE** (see below)</td>
                                            </tr>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>Evidence mismatch</td>
                                                <td>Offer re-analysis or exclusion</td>
                                            </tr>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>Schema mismatch</td>
                                                <td>Re-analyze with correct schema</td>
                                            </tr>
                                            <tr>
                                                <td>Step 4</td>
                                                <td><3 papers validated</td>
                                                <td>Warn, proceed with caution</td>
                                            </tr>
                                            <tr>
                                                <td>Step 4</td>
                                                <td>0 papers validated</td>
                                                <td>Fail - nothing to analyze</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Concurrency & Performance</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Setting</th>
                                                <th>Value</th>
                                                <th>Notes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Max concurrent subagents</td>
                                                <td>15</td>
                                                <td>Parallel analysis for speed</td>
                                            </tr>
                                            <tr>
                                                <td>Timeout per paper</td>
                                                <td>5 min</td>
                                                <td>Generous for large papers</td>
                                            </tr>
                                            <tr>
                                                <td>Retry on failure</td>
                                                <td>1</td>
                                                <td>Single retry before exclusion</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            write partial progress:**
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            `chunks_completed`
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Error Handlers</span>
                                    <span class="content-badge">8</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="error-handler">
                                    <div class="error-type">No chunks found</div>
                                    <div class="error-solution">Redirect to create-research-project</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">No _briefing.md</div>
                                    <div class="error-solution">Fail with clear message</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Subagent fails</div>
                                    <div class="error-solution">Retry once, then mark failed</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Subagent timeout</div>
                                    <div class="error-solution">**PARTIAL SAVE** (see below)</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Evidence mismatch</div>
                                    <div class="error-solution">Offer re-analysis or exclusion</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Schema mismatch</div>
                                    <div class="error-solution">Re-analyze with correct schema</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type"><3 papers validated</div>
                                    <div class="error-solution">Warn, proceed with caution</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">0 papers validated</div>
                                    <div class="error-solution">Fail - nothing to analyze</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-blue); margin-bottom: 0.5rem;">Inputs</h5>
                                <div class="file-list">
                                    <div class="file-ref input" title="">_analysis_log.md</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="skill-section" id="skill-synthesize-research-project">
                <div class="skill-header">
                    <h2>synthesize-research-project</h2>
                    <p>Synthesize analyzed research papers into comprehensive reports (Phase 3). Load when user says 'synthesize research project', 'generate synthesis', 'create synthesis report', or wants cross-paper synthesis. Expects analyzed papers with index.md from analyze-research-project.</p>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase A: VALIDATION</h3>
                    </div>
                    <div class="step-card" id="step-0">
                        <div class="step-header">
                            <div class="step-number">0</div>
                            <div class="step-title">
                                <h4>Initialize Task Tracking</h4>
                                <div class="step-meta">Phase ? ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            MANDATORY: Use TodoWrite at start of skill: Update todos as each step completes.
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**MANDATORY: Use TodoWrite at start of skill:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>TodoWrite with initial todos:
- [ ] Validate readiness (Step 1)
- [ ] Run build_synthesis_routing.py (Step 2 - Level 1)
- [ ] Run calculate_subagent_allocation.py (Step 3 - Level 2)
- [ ] Run generate_subagent_prompts.py (Step 4 - Level 3)
- [ ] Spawn batch extraction subagents (Step 5 - Level 4)
- [ ] Run verify_subagent_output.py (Step 6 - Level 5)
- [ ] Run aggregate_patterns.py (Step 7 - Level 6)
- [ ] Spawn final report subagent (Step 8 - Level 7)
- [ ] Mark project COMPLETE (Step 9)</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card" id="step-1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">
                                <h4>Validate Readiness</h4>
                                <div class="step-meta">Phase A ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run interface validation script first (catches format mismatches): If validation fails, papers need re-analysis with the updated skill (which includes inline YAML template). Check prerequisites including chunk_index (required for 7-level routing):
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run interface validation script first (catches format mismatches):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># RECOMMENDED: Run validation before synthesis
python 03-skills/research-pipeline/shared/contracts/validate_interface.py {project_path}</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Check prerequisites including chunk_index (required for 7-level routing):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>project_path = "02-projects/NN-{slug}/"
papers_path = project_path / "02-resources/papers"

# Check briefing exists (with research_purpose - G22a)
if not exists(project_path / "02-resources/_briefing.md"):
    fail("Missing _briefing.md - research question not defined")

briefing = read(project_path / "02-resources/_briefing.md")
if 'research_purpose' not in briefing:
    warn("Missing research_purpose in _briefing.md (G22a) - subagents may lack context")

# Find papers with index.md that have chunk_index (Schema 2.3+)
papers_valid = []
papers_legacy = []
for folder in papers_path.iterdir():
    if folder.is_dir() and (folder / "index.md").exists():
        index = read(folder / "index.md")
        if 'chunk_index' in index.frontmatter:
            papers_valid.append(folder.name)
        else:
            papers_legacy.append(folder.name)

if len(papers_valid) < 3:
    if papers_legacy:
        fail(f"""
        Only {len(papers_valid)} papers have chunk_index (Schema 2.3+).
        {len(papers_legacy)} papers use legacy schema without chunk_index.

        Re-analyze legacy papers with: "analyze research project {name}"
        Legacy papers: {papers_legacy}
        """)
    else:
        fail(f"Only {len(papers_valid)} papers analyzed - need at least 3 for synthesis")

# Read briefing to get extraction fields
extraction_fields = briefing.extraction_schema</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>fail(f"Only {len(papers_valid)} papers analyzed - need at least 3 for synthesis")

# Read briefing to get extraction fields
extraction_fields = briefing.extraction_schema
```

### Display Status</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
RESEARCH PROJECT READY FOR 7-LEVEL SYNTHESIS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Research Project: {name}
Research Question: "{RQ}"
Research Purpose: "{research_purpose}"

Papers with chunk_index: {N} (ready for routing)
Legacy papers:          {M} (need re-analysis)
Extraction fields:      {K} (from _briefing.md)

Proceeding with Level 1 (Routing)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            prerequisites including chunk_index (required for 7-level routing):**
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            briefing exists (with research_purpose - G22a)
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Error Handlers</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="error-handler">
                                    <div class="error-type">validation fails</div>
                                    <div class="error-solution">papers need re-analysis with the updated skill (which includes inline YAML template)</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/shared/contracts/validate_interface.py</span>
                                    </div>
                                    <div class='script-purpose'>first (catches format mismatches):**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/shared/contracts/validate_interface.py {project_path}</code></div>
                                    <div class='script-params'>Parameters: <code>{project_path}</code></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase B: ROUTING (Script - Level 1)</h3>
                    </div>
                    <div class="step-card" id="step-2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">
                                <h4>Build Synthesis Routing Table</h4>
                                <div class="step-meta">Phase B ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run script to build routing from chunk_index.fields_found: What the script does (deterministic - no LLM): 1. Reads all index.md files with chunk_index 2. For each field from _briefing.md: Looks up `chunk_index[N].fields_found[field]` If `true` or `partial` ‚Üí add chunk to routing 3. **Sparsity Check (Gap G19)**: Warns if field matches >80% of chunks 4. Outputs routing table Output:: `02-resources/_synthesis_routing.yaml`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads all index.md files with chunk_index</li>
                                    <li class="substep-item">For each field from _briefing.md:</li>
                                    <li class="substep-item">**Sparsity Check (Gap G19)**: Warns if field matches >80% of chunks</li>
                                    <li class="substep-item">Outputs routing table</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run script to build routing from chunk_index.fields_found:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/validation/scripts/build_synthesis_routing.py \
  {project_path} \
  --output 02-resources/_synthesis_routing.yaml</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Outputs routing table

**Output:** `02-resources/_synthesis_routing.yaml`

### Routing Table Structure (NEW - based on chunk_index)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>project: 02-projects/02-ontologies-research
generated_at: "2025-12-28T14:30:00"
algorithm: "boolean_lookup"  # Not full-text search

fields:
  entity_types:
    description: "Core entity types defined"
    priority: high
    sparsity_warning: false  # <80% match rate OK
    chunks:
      - paper_id: 02-Knowledge_Graphs
        chunk: 2
        fields_found_state: true  # From index.md
        token_count: 12500        # From index.md
      - paper_id: 02-Knowledge_Graphs
        chunk: 6
        fields_found_state: true
        token_count: 8200
      - paper_id: 05-DOLCE
        chunk: 1
        fields_found_state: partial  # Partial counts
        token_count: 15000

  ai_integration:
    priority: high
    sparsity_warning: true   # >80% match rate - warn user!
    chunks:
      - paper_id: 16-KG-Agent
        chunk: 1
        fields_found_state: true
        token_count: 10000

stats:
  papers_analyzed: 23
  total_chunks: 127
  chunks_per_field_avg: 34</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>-KG-Agent
        chunk: 1
        fields_found_state: true
        token_count: 10000

stats:
  papers_analyzed: 23
  total_chunks: 127
  chunks_per_field_avg: 34
```

### Display Routing (Level 1)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
LEVEL 1: SYNTHESIS ROUTING (from chunk_index)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Fields to synthesize: 15
Total chunks routed: 127

| Field | Chunks (true) | Chunks (partial) | Sparsity |
|-------|---------------|------------------|----------|
| entity_types | 28 | 6 | OK |
| ai_integration | 35 | 3 | ‚ö†Ô∏è 85% match |
| framework_comparison | 22 | 6 | OK |
...

‚ö†Ô∏è SPARSITY WARNING (Gap G19):
   ai_integration matches 85% of chunks.
   Consider splitting into sub-fields or removing generic field.

Proceeding with Level 2 (Allocation)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>Fields to synthesize: 15
Total chunks routed: 127</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Chunks (true)</th>
                                                <th>Chunks (partial)</th>
                                                <th>Sparsity</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>entity_types</td>
                                                <td>28</td>
                                                <td>6</td>
                                                <td>OK</td>
                                            </tr>
                                            <tr>
                                                <td>ai_integration</td>
                                                <td>35</td>
                                                <td>3</td>
                                                <td>‚ö†Ô∏è 85% match</td>
                                            </tr>
                                            <tr>
                                                <td>framework_comparison</td>
                                                <td>22</td>
                                                <td>6</td>
                                                <td>OK</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            (Gap G19)**: Warns if field matches >80% of chunks
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/validation/scripts/build_synthesis_routing.py</span>
                                    </div>
                                    <div class='script-purpose'>to build routing from chunk_index.fields_found:**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/validation/scripts/build_synthesis_routing.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">"boolean_lookup"  # Not full-text search</span>
                                    </div>
                                    <div class="pattern-description">fields:
  entity_types:
    description: "Core entity types defined"
    priority: high
    sparsity_warning: false  # <80% match rate OK
    chunks:
      - paper_id: 02-Knowledge_Graphs
        chunk: 2
        fields_found_state: true  # From index.md
        token_count: 12500        # From index.md
      - paper_id: 02-Knowledge_Graphs
        chunk: 6
        fields_found_state: true
        token_count: 8200
      - paper_id: 05-DOLCE
        chunk: 1
        fields_found_state: partial  </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase C: ALLOCATION (Script - Level 2)</h3>
                    </div>
                    <div class="step-card" id="step-3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">
                                <h4>Calculate Subagent Allocation</h4>
                                <div class="step-meta">Phase C ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run script to allocate chunks to subagent batches with token budget: What the script does (deterministic - no LLM): 1. Reads routing table with token counts per chunk 2. Uses greedy bin-packing to fit chunks into 70k token batches 3. Groups chunks by paper when possible (context preservation) 4. Calculates Level 7 budget (Gap G2) 5. Outputs subagent plan Output:: `02-resources/_subagent_plan.yaml`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads routing table with token counts per chunk</li>
                                    <li class="substep-item">Uses greedy bin-packing to fit chunks into 70k token batches</li>
                                    <li class="substep-item">Groups chunks by paper when possible (context preservation)</li>
                                    <li class="substep-item">Calculates Level 7 budget (Gap G2)</li>
                                    <li class="substep-item">Outputs subagent plan</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run script to allocate chunks to subagent batches with token budget:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/validation/scripts/calculate_subagent_allocation.py \
  {project_path} \
  --input 02-resources/_synthesis_routing.yaml \
  --output 02-resources/_subagent_plan.yaml</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Outputs subagent plan

**Output:** `02-resources/_subagent_plan.yaml`

### Subagent Plan Structure</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>project: 02-projects/02-ontologies-research
generated_at: "2025-12-28T14:35:00"
token_budget_per_batch: 70000
standard_formula: "chars // 4"  # Gap G3

# Level 4 batches (extraction subagents)
level4_batches:
  - batch_id: "entity_types_1"
    field: entity_types
    chunks:
      - paper_id: 02-Knowledge_Graphs
        chunk: 2
        token_count: 12500
      - paper_id: 02-Knowledge_Graphs
        chunk: 6
        token_count: 8200
    total_tokens: 45700
    estimated_duration: "3 min"

  - batch_id: "entity_types_2"
    field: entity_types
    chunks:
      - paper_id: 05-DOLCE
        chunk: 1
        token_count: 15000
    total_tokens: 62000
    estimated_duration: "4 min"

# Level 7 budget calculation (Gap G2)
level7_budget:
  methodology: 3000
  briefing: 2050  # +50 for research_purpose
  synthesis_files_estimated: 45000
  output_reservation: 20000
  total_available: 100000
  usable: 29950
  requires_split: false
  split_strategy: null

stats:
  total_batches: 45
  max_concurrent: 15
  estimated_total_time: "25 min"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>ailable: 100000
  usable: 29950
  requires_split: false
  split_strategy: null

stats:
  total_batches: 45
  max_concurrent: 15
  estimated_total_time: "25 min"
```

### Display Allocation (Level 2)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
LEVEL 2: SUBAGENT ALLOCATION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Token budget per batch: 70,000
Batches calculated: 45

| Field | Batches | Avg Tokens/Batch |
|-------|---------|------------------|
| entity_types | 6 | 58,000 |
| ai_integration | 7 | 62,000 |
| framework_comparison | 5 | 55,000 |
...

Level 7 Budget Check:
  Synthesis files: ~45,000 tokens
  Usable: 29,950 tokens
  Status: ‚úì No split required

Proceeding with Level 3 (Prompt Generation)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>Token budget per batch: 70,000
Batches calculated: 45</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Batches</th>
                                                <th>Avg Tokens/Batch</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>entity_types</td>
                                                <td>6</td>
                                                <td>58,000</td>
                                            </tr>
                                            <tr>
                                                <td>ai_integration</td>
                                                <td>7</td>
                                                <td>62,000</td>
                                            </tr>
                                            <tr>
                                                <td>framework_comparison</td>
                                                <td>5</td>
                                                <td>55,000</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            Synthesis files: ~45,000 tokens
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/validation/scripts/calculate_subagent_allocation.py</span>
                                    </div>
                                    <div class='script-purpose'>to allocate chunks to subagent batches with token budget:**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/validation/scripts/calculate_subagent_allocation.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Gap Fixes</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="gap-fix-item">
                                    <div class="gap-fix-header">
                                        <span class="gap-id">G3</span>
                                        <span class="gap-description"># Level 4 batches (extraction subagents)</span>
                                    </div>
                                    <div class="gap-context">generated_at: "2025-12-28T14:35:00"
token_budget_per_batch: 70000
standard_formula: "chars // 4"  # Gap G3

# Level 4 batches (extraction subagents)
level4_batches:
  - batch_id: "entity_types_1"
    field: entity_types
    chunks:
      - paper_id: 02-Knowledge_Graphs
        chunk: 2
        token</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase D: PROMPT GENERATION (Script - Level 3)</h3>
                    </div>
                    <div class="step-card" id="step-4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">
                                <h4>Generate Subagent Prompts</h4>
                                <div class="step-meta">Phase D ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run script to generate prompts with INPUT CONTRACT: What the script does (deterministic - no LLM): 1. Reads subagent plan 2. Reads _briefing.md for research_purpose (G22a) 3. Reads _analysis_kit.md for synthesis_goals (G22b) 4. Generates INPUT CONTRACT per subagent (G13) 5. Outputs prompt files Output:: `03-working/prompts/_prompt_{batch_id}.md` patterns: name: "Pattern Name" chunk_ref: "Paper-ID (Chunk N:Line-Line)" quote: "Exact text proving pattern..." description: "Full context and detail"
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">10</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads subagent plan</li>
                                    <li class="substep-item">Reads _briefing.md for research_purpose (G22a)</li>
                                    <li class="substep-item">Reads _analysis_kit.md for synthesis_goals (G22b)</li>
                                    <li class="substep-item">Generates INPUT CONTRACT per subagent (G13)</li>
                                    <li class="substep-item">Outputs prompt files</li>
                                    <li class="substep-item">`{project_path}/02-resources/_briefing.md`</li>
                                    <li class="substep-item">`{paper_path}/{paper_id}_{chunk}.md`</li>
                                    <li class="substep-item">Read EACH chunk completely</li>
                                    <li class="substep-item">Extract patterns with:</li>
                                    <li class="substep-item">Write YAML output to: 03-working/_batch_{field}_{N}.yaml</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run script to generate prompts with INPUT CONTRACT:**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/validation/scripts/generate_subagent_prompts.py \
  {project_path} \
  --input 02-resources/_subagent_plan.yaml \
  --output-dir 03-working/prompts/</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>Outputs prompt files

**Output:** `03-working/prompts/_prompt_{batch_id}.md`

### Generated Prompt Template</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Batch Extraction: {field_name} (Batch {N} of {total})

## INPUT CONTRACT (STRICT - Gap G13)

### Files You MUST Read (in this order)
1. `{project_path}/02-resources/_briefing.md`
2. `{paper_path}/{paper_id}_{chunk}.md`
[... exact list for this batch]

### Files You MUST NOT Read
- ANY `.pdf` file
- ANY other batch's chunks
- ANY file in 04-outputs/

VIOLATION = Extraction fails validation.

## CONTEXT (Gap G22a, G22b)
Research Purpose: {research_purpose}
Synthesis Goals: {synthesis_goals}

## EXTRACTION CONTRACT

For field "{field_name}":
1. Read EACH chunk completely
2. Extract patterns with:
   - name: Pattern name
   - chunk_ref: Paper-ID (Chunk N:Line-Line)
   - quote: "Exact text from chunk" (100-150 chars)
   - description: Full context

3. Write YAML output to: 03-working/_batch_{field}_{N}.yaml</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>_batch_{field}_{N}.yaml

```yaml
patterns:
  - name: "Pattern Name"
    chunk_ref: "Paper-ID (Chunk N:Line-Line)"
    quote: "Exact text proving pattern..."
    description: "Full context and detail"</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>```

### Display Prompts Generated (Level 3)</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            Read (in this order)
                                        </div>
                                    </li>
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            NOT Read
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìÅ Files</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <h5 style="color: var(--accent-blue); margin-bottom: 0.5rem;">Inputs</h5>
                                <div class="file-list">
                                    <div class="file-ref input" title="">{project_path}/02-resources/_briefing.md</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/validation/scripts/generate_subagent_prompts.py</span>
                                    </div>
                                    <div class='script-purpose'>to generate prompts with INPUT CONTRACT:**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/validation/scripts/generate_subagent_prompts.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">name</span>
                                    </div>
                                    <div class="pattern-description">- chunk_ref: Paper-ID (Chunk N:Line-Line)
   - quote: "Exact text from chunk" (100-150 chars)
   - description: Full context

3. Write YAML output to: 03-working/_batch_{field}_{N}.yaml

```yaml
patterns:
  - name: "Pattern Name"
    chunk_ref: "Paper-ID (Chunk N:Line-Line)"
    quote: "Exact text proving pattern..."
    description: "Full context and detail"
```
```</div>
                                    <div class="pattern-code">
                                        <pre><code>patterns:
  - name: "Pattern Name"
    chunk_ref: "Paper-ID (Chunk N:Line-Line)"
    quote: "Exact text proving pattern..."
    description: "Full context and detail"</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase E: EXTRACTION (Subagents - Level 4)</h3>
                    </div>
                    <div class="step-card" id="step-5">
                        <div class="step-header">
                            <div class="step-number">5</div>
                            <div class="step-title">
                                <h4>Spawn Batch Extraction Subagents</h4>
                                <div class="step-meta">Phase E ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Spawn subagents with prompt file path (subagent reads prompt, not orchestrator): CRITICAL: Do NOT read prompt content yourself. Pass the file path and let the subagent read it. This saves orchestrator context tokens. Subagent Output:: `03-working/_batch_{field}_{N}.yaml` | Setting | Value | Notes | |---------|-------|-------| | Max concurrent subagents | 15 | Parallel extraction | | Timeout per batch | 5 min | Generous for large batches | | Retry on failure | 1 | Single retry |
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Spawn subagents with prompt file path (subagent reads prompt, not orchestrator):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Get prompt file paths
prompt_dir = project_path / "03-working/prompts/"
prompts = list(prompt_dir.glob("_prompt_*.md"))

# Spawn in parallel (max 15) - subagent reads prompt file directly
for prompt_file in prompts:
    batch_id = prompt_file.stem.replace("_prompt_", "")
    Task(
        subagent_type="general-purpose",
        prompt=f"Read and follow instructions in: {prompt_file}",
        description=f"Extract {batch_id}"
    )</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>**Subagent Output:** `03-working/_batch_{field}_{N}.yaml`

### Output Schema (YAML - for script processing)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
batch_id: "entity_types_1"
field: entity_types
extracted_at: "2025-12-28T14:40:00"
chunks_read: 3
patterns_found: 8
---

patterns:
  - name: "Endurant (Continuant)"
    chunk_ref: "02-Knowledge_Graphs (Chunk 2:128-133)"
    quote: "An endurant is wholly present at any time during its existence..."
    description: "Core distinction in UFO ontology between things that persist (endurants) vs events (perdurants)"

  - name: "Perdurant (Occurrent)"
    chunk_ref: "02-Knowledge_Graphs (Chunk 2:131-135)"
    quote: "A perdurant can only be partially present at any moment..."
    description: "Events, processes, activities - things that unfold over time"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>--|-------|
| Max concurrent subagents | 15 | Parallel extraction |
| Timeout per batch | 5 min | Generous for large batches |
| Retry on failure | 1 | Single retry |

### Progress Display (Level 4)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>Spawning extraction subagents...
  [entity_types_1] COMPLETE (3 chunks, 8 patterns)
  [entity_types_2] COMPLETE (4 chunks, 12 patterns)
  [entity_types_3] IN_PROGRESS
  [ai_integration_1] COMPLETE (5 chunks, 15 patterns)
  ...

Extracted: 38/45 batches
In progress: 7
Failed: 0</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>### Concurrency Settings</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Setting</th>
                                                <th>Value</th>
                                                <th>Notes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Max concurrent subagents</td>
                                                <td>15</td>
                                                <td>Parallel extraction</td>
                                            </tr>
                                            <tr>
                                                <td>Timeout per batch</td>
                                                <td>5 min</td>
                                                <td>Generous for large batches</td>
                                            </tr>
                                            <tr>
                                                <td>Retry on failure</td>
                                                <td>1</td>
                                                <td>Single retry</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase F: VERIFICATION (Script - Level 5)</h3>
                    </div>
                    <div class="step-card" id="step-6">
                        <div class="step-header">
                            <div class="step-number">6</div>
                            <div class="step-title">
                                <h4>Verify Subagent Outputs</h4>
                                <div class="step-meta">Phase F ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run script to verify subagent outputs with quote-line verification (Gap G15): What the script does (deterministic - no LLM): 1. Reads all _batch_{field}_{N}.yaml files 2. For each batch, samples 10% of patterns 3. For each sampled pattern: Parses chunk_ref: "Paper-ID (Chunk N:Line-Line)" Reads the actual chunk file Checks if quote exists at cited lines (¬±5 lines tolerance) 4. Reports verification pass/fail Output:: `03-working/_verification_report.yaml` If verification rate < 90%: 1. Identify worst-performing batches 2. Re-run extraction for those batches only 3. Re-verify
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">7</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads all _batch_{field}_{N}.yaml files</li>
                                    <li class="substep-item">For each batch, samples 10% of patterns</li>
                                    <li class="substep-item">For each sampled pattern:</li>
                                    <li class="substep-item">Reports verification pass/fail</li>
                                    <li class="substep-item">Identify worst-performing batches</li>
                                    <li class="substep-item">Re-run extraction for those batches only</li>
                                    <li class="substep-item">Re-verify</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run script to verify subagent outputs with quote-line verification (Gap G15):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/validation/scripts/verify_subagent_output.py \
  {project_path} \
  --input-dir 03-working/ \
  --sample-rate 0.1 \
  --output 03-working/_verification_report.yaml</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Reports verification pass/fail

**Output:** `03-working/_verification_report.yaml`

### Verification Report Structure</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>verified_at: "2025-12-28T14:50:00"
sample_rate: 0.1
batches_checked: 45
patterns_sampled: 120
patterns_verified: 112
patterns_failed: 8

failures:
  - batch_id: "entity_types_2"
    pattern: "Perdurant Definition"
    chunk_ref: "05-DOLCE (Chunk 1:150-155)"
    expected_quote: "A perdurant can only..."
    actual_at_lines: "Different text found"
    verdict: "FAIL - quote mismatch"

stats:
  verification_rate: 93.3%
  threshold: 90%
  verdict: "PASS"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>nly..."
    actual_at_lines: "Different text found"
    verdict: "FAIL - quote mismatch"

stats:
  verification_rate: 93.3%
  threshold: 90%
  verdict: "PASS"
```

### Display Verification (Level 5)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
LEVEL 5: QUOTE-LINE VERIFICATION (Gap G15)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Batches verified: 45
Patterns sampled: 120 (10%)
Patterns verified: 112 (93.3%)
Patterns failed: 8

‚ö†Ô∏è Failed patterns:
  entity_types_2: "Perdurant Definition" - quote mismatch
  ai_integration_3: "Agent Handoff" - line drift

Verdict: PASS (93.3% > 90% threshold)

Proceeding with Level 6 (Aggregation)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            subagent outputs with quote-line verification (Gap G15):**
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            ---
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/validation/scripts/verify_subagent_output.py</span>
                                    </div>
                                    <div class='script-purpose'>to verify subagent outputs with quote-line verification (Gap G15):**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/validation/scripts/verify_subagent_output.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">- Parses chunk_ref: "Paper-ID (Chunk N:Line-Line)"</span>
                                    </div>
                                    <div class="pattern-description">- Reads the actual chunk file
   - Checks if quote exists at cited lines (¬±5 lines tolerance)
4. Reports verification pass/fail</div>
                                    
                                </div>
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">"Perdurant Definition"</span>
                                    </div>
                                    <div class="pattern-description">chunk_ref: "05-DOLCE (Chunk 1:150-155)"
    expected_quote: "A perdurant can only..."
    actual_at_lines: "Different text found"
    verdict: "FAIL - quote mismatch"

stats:
  verification_rate: 93.3%
  threshold: 90%
  verdict: "PASS"
```</div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase G: AGGREGATION (Script - Level 6)</h3>
                    </div>
                    <div class="step-card gate" id="step-7">
                        <div class="step-header">
                            <div class="step-number">7</div>
                            <div class="step-title">
                                <h4>Aggregate Patterns</h4>
                                <div class="step-meta">Phase G ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Run script to merge patterns across batches (deterministic - no LLM): What the script does (deterministic - no LLM): 1. Reads all _batch_{field}_{N}.yaml for each field 2. Merges patterns by name (fuzzy match with 90% similarity) 3. Combines sources: if Pattern X appears in 3 batches, all 3 sources merged 4. Outputs aggregated YAML per field Output:: `04-outputs/_synthesis_{field}.yaml`
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">Reads all _batch_{field}_{N}.yaml for each field</li>
                                    <li class="substep-item">Merges patterns by name (fuzzy match with 90% similarity)</li>
                                    <li class="substep-item">Combines sources: if Pattern X appears in 3 batches, all 3 sources merged</li>
                                    <li class="substep-item">Outputs aggregated YAML per field</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">bash</span>
                                        <div class='code-context'>**Run script to merge patterns across batches (deterministic - no LLM):**</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>python 03-skills/research-pipeline/validation/scripts/aggregate_patterns.py \
  {project_path} \
  --input-dir 03-working/ \
  --output-dir 04-outputs/</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>Outputs aggregated YAML per field

**Output:** `04-outputs/_synthesis_{field}.yaml`

### Aggregated Field Structure</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>field: entity_types
aggregated_at: "2025-12-28T14:55:00"
batches_merged: 6
patterns_input: 45
patterns_output: 23  # After deduplication

patterns:
  - name: "Endurant (Continuant)"
    sources:
      - chunk_ref: "02-Knowledge_Graphs (Chunk 2:128-133)"
        quote: "An endurant is wholly present..."
      - chunk_ref: "05-DOLCE (Chunk 1:89-95)"
        quote: "DOLCE distinguishes endurants..."
      - chunk_ref: "23-UFO (Chunk 1:173-180)"
        quote: "In UFO, endurants are..."
    description: "Merged from 3 sources. Core distinction: entities wholly present at any time."

  - name: "Perdurant (Occurrent)"
    sources:
      - chunk_ref: "02-Knowledge_Graphs (Chunk 2:131-135)"
        quote: "A perdurant can only be partially present..."
    description: "Events and processes that unfold over time."</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>nowledge_Graphs (Chunk 2:131-135)"
        quote: "A perdurant can only be partially present..."
    description: "Events and processes that unfold over time."
```

### Display Aggregation (Level 6)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
LEVEL 6: PATTERN AGGREGATION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

| Field | Patterns In | Patterns Out | Dedup Rate |
|-------|-------------|--------------|------------|
| entity_types | 45 | 23 | 49% |
| ai_integration | 52 | 31 | 40% |
| framework_comparison | 38 | 22 | 42% |
...

Total patterns: 280 ‚Üí 156 (44% deduplication)

Aggregated files saved to: 04-outputs/_synthesis_*.yaml

Proceeding with Level 7 (Final Report)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>LEVEL 6: PATTERN AGGREGATION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Patterns In</th>
                                                <th>Patterns Out</th>
                                                <th>Dedup Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>entity_types</td>
                                                <td>45</td>
                                                <td>23</td>
                                                <td>49%</td>
                                            </tr>
                                            <tr>
                                                <td>ai_integration</td>
                                                <td>52</td>
                                                <td>31</td>
                                                <td>40%</td>
                                            </tr>
                                            <tr>
                                                <td>framework_comparison</td>
                                                <td>38</td>
                                                <td>22</td>
                                                <td>42%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚öôÔ∏è Scripts</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="script-item">
                                    <div class="script-header">
                                        <span class="script-name">03-skills/research-pipeline/validation/scripts/aggregate_patterns.py</span>
                                    </div>
                                    <div class='script-purpose'>to merge patterns across batches (deterministic - no LLM):**</div>
                                    <div class="script-command"><code>python 03-skills/research-pipeline/validation/scripts/aggregate_patterns.py \</code></div>
                                    <div class='script-params'>Parameters: <code>\</code></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">X appears in 3 batches, all 3 sources merged</span>
                                    </div>
                                    <div class="pattern-description">4. Outputs aggregated YAML per field</div>
                                    
                                </div>
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">AGGREGATION</span>
                                    </div>
                                    <div class="pattern-description">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

| Field | Patterns In | Patterns Out | Dedup Rate |
|-------|-------------|--------------|------------|
| entity_types | 45 | 23 | 49% |
| ai_integration | 52 | 31 | 40% |
| framework_comparison | 38 | 22 | 42% |
...

Total patterns: 280 ‚Üí 156 (44% deduplication)

Aggregated files saved to: 04-outputs/_synthesis_*.yaml

Proceeding with Level 7 (Final Report)...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

---

# PHASE H: FINAL REPORT (Subagent - L</div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase H: FINAL REPORT (Subagent - Level 7)</h3>
                    </div>
                    <div class="step-card" id="step-8">
                        <div class="step-header">
                            <div class="step-number">8</div>
                            <div class="step-title">
                                <h4>Generate Synthesis Report</h4>
                                <div class="step-meta">Phase H ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Spawn final report subagent with token budget (Gap G2):
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">12</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">`{project_path}/02-resources/_briefing.md`</li>
                                    <li class="substep-item">`{project_path}/04-outputs/_synthesis_entity_types.yaml`</li>
                                    <li class="substep-item">`{project_path}/04-outputs/_synthesis_ai_integration.yaml`</li>
                                    <li class="substep-item">Executive Summary (3-4 paragraphs answering RQ with citations)</li>
                                    <li class="substep-item">Key Findings (5-8 findings with evidence tables)</li>
                                    <li class="substep-item">Cross-Field Insights (patterns spanning multiple fields)</li>
                                    <li class="substep-item">Recommendations (3-5 with supporting evidence)</li>
                                    <li class="substep-item">Limitations</li>
                                    <li class="substep-item">Appendix A: Field Summaries</li>
                                    <li class="substep-item">Appendix B: Full Reference List</li>
                                    <li class="substep-item">Foundational ontologies share 4 core entity types [02-KG (2:128), 05-DOLCE (1:89)]</li>
                                    <li class="substep-item">AI integration patterns favor hybrid approaches [16-KG-Agent (1:240)]</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">python</span>
                                        <div class='code-context'>**Spawn final report subagent with token budget (Gap G2):**

### Pre-Check: Token Budget</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># Read Level 7 budget from _subagent_plan.yaml
plan = read(f"{project_path}/02-resources/_subagent_plan.yaml")
budget = plan['level7_budget']

if budget['requires_split']:
    # Need multiple Level 7 passes
    # Group fields by priority from _briefing.md
    high_priority = [f for f in fields if f['priority'] == 'high']
    medium_priority = [f for f in fields if f['priority'] == 'medium']

    # Pass 1: High-priority fields
    spawn_level7_subagent(high_priority, output="_synthesis_report_high.md")
    # Pass 2: Medium-priority fields
    spawn_level7_subagent(medium_priority, output="_synthesis_report_medium.md")
    # Pass 3: Merge
    spawn_level7_merge_subagent()
else:
    # Single pass - fits in budget
    spawn_level7_subagent(all_fields, output="_synthesis_report.md")</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>ge
    spawn_level7_merge_subagent()
else:
    # Single pass - fits in budget
    spawn_level7_subagent(all_fields, output="_synthesis_report.md")
```

### Final Report Subagent Prompt (WITH BUDGET)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre># FINAL SYNTHESIS REPORT (Level 7)

## TOKEN BUDGET (Gap G2)
You have LIMITED context. Stay within budget:
- Synthesis files: {synthesis_tokens} tokens
- Methodology: 3,000 tokens
- Output reservation: 20,000 tokens
- Usable: {usable_tokens} tokens

## INPUT CONTRACT (STRICT)
Read these files ONLY:
1. `{project_path}/02-resources/_briefing.md`
2. `{project_path}/04-outputs/_synthesis_entity_types.yaml`
3. `{project_path}/04-outputs/_synthesis_ai_integration.yaml`
[... exact list from _subagent_plan.yaml]

DO NOT read chunk files directly - use citations from synthesis files.

## CONTEXT
Research Question: {research_question}
Research Purpose: {research_purpose}

## OUTPUT CONTRACT
Write to: `{project_path}/04-outputs/_synthesis_report.md`

Structure:
1. Executive Summary (3-4 paragraphs answering RQ with citations)
2. Key Findings (5-8 findings with evidence tables)
3. Cross-Field Insights (patterns spanning multiple fields)
4. Recommendations (3-5 with supporting evidence)
5. Limitations
6. Appendix A: Field Summaries
7. Appendix B: Full Reference List

CRITICAL:
- Every claim MUST have inline citation: [Paper-ID (Chunk:Line)]
- Include block quotes for key evidence
- Full reference list at end</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">markdown</span>
                                        <div class='code-context'>ndix B: Full Reference List

CRITICAL:
- Every claim MUST have inline citation: [Paper-ID (Chunk:Line)]
- Include block quotes for key evidence
- Full reference list at end
```

### Output Structure</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>---
synthesized_at: "{timestamp}"
research_question: "{RQ}"
research_purpose: "{purpose}"
papers_included: 23
fields_synthesized: ["entity_types", "ai_integration", ...]
token_budget_used: {actual}
---

# Research Synthesis: {Title}

## Executive Summary

This synthesis analyzed 23 papers across 15 fields...

Key findings:
1. Foundational ontologies share 4 core entity types [02-KG (2:128), 05-DOLCE (1:89)]
2. AI integration patterns favor hybrid approaches [16-KG-Agent (1:240)]
...

## Key Findings

### Finding 1: Core Entity Type Convergence

| Source | Evidence | Pattern |
|--------|----------|---------|
| 02-Knowledge_Graphs | 2:128-133 | Endurant definition |
| 05-DOLCE | 1:89-95 | Continuant distinction |

> "An endurant is wholly present at any time during its existence"
> ‚Äî 02-Knowledge_Graphs (Chunk 2:128-133)

...

## Appendix B: Full Reference List

| Paper ID | Title | Chunks Cited |
|----------|-------|--------------|
| 02-Knowledge_Graphs | Survey of... | 2:128, 6:45 |
| 05-DOLCE | A Descriptive... | 1:89 |</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>| 1:89 |
```

### Progress Display (Level 7)</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
LEVEL 7: FINAL REPORT GENERATION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Token budget check:
  Synthesis files: 45,000 tokens
  Usable: 29,950 tokens
  Split required: No

Spawning final report subagent...

[Level 7] Generating synthesis report... COMPLETE

Output: 04-outputs/_synthesis_report.md
  - 23 papers synthesized
  - 156 patterns aggregated
  - 8 key findings
  - 12 cross-field insights

Proceeding with completion...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>### Finding 1: Core Entity Type Convergence</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Source</th>
                                                <th>Evidence</th>
                                                <th>Pattern</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>02-Knowledge_Graphs</td>
                                                <td>2:128-133</td>
                                                <td>Endurant definition</td>
                                            </tr>
                                            <tr>
                                                <td>05-DOLCE</td>
                                                <td>1:89-95</td>
                                                <td>Continuant distinction</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Appendix B: Full Reference List</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Paper ID</th>
                                                <th>Title</th>
                                                <th>Chunks Cited</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>02-Knowledge_Graphs</td>
                                                <td>Survey of...</td>
                                                <td>2:128, 6:45</td>
                                            </tr>
                                            <tr>
                                                <td>05-DOLCE</td>
                                                <td>A Descriptive...</td>
                                                <td>1:89</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">3</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            - Every claim MUST have inline citation: [Paper-ID (Chunk:Line)]
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            Token Budget
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            Synthesis files: 45,000 tokens
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">1</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">|</span>
                                    </div>
                                    <div class="pattern-description">|--------|----------|---------|
| 02-Knowledge_Graphs | 2:128-133 | Endurant definition |
| 05-DOLCE | 1:89-95 | Continuant distinction |

> "An endurant is wholly present at any time during its existence"
> ‚Äî 02-Knowledge_Graphs (Chunk 2:128-133)

...</div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="phase-section">
                    <div class="phase-header">
                        <h3>Phase I: COMPLETION</h3>
                    </div>
                    <div class="step-card" id="step-9">
                        <div class="step-header">
                            <div class="step-number">9</div>
                            <div class="step-title">
                                <h4>Mark Project COMPLETE</h4>
                                <div class="step-meta">Phase I ¬∑ synthesize-research-project</div>
                            </div>
                        </div>

                        <div class="step-description">
                            Update project status: | File | Location | Purpose | Level | |------|----------|---------|-------| | `_synthesis_routing.yaml` | 02-resources/ | Routing table (from chunk_index) | L1 | | `_subagent_plan.yaml` | 02-resources/ | Allocation + token budgets | L2 | | `_prompt_{batch_id}.md` | 03-working/prompts/ | Generated subagent prompts | L3 | | `_batch_{field}_{N}.yaml` | 03-working/ | Batch extraction outputs (YAML) | L4 | | `_verification_report.yaml` | 03-working/ | Quote-line verification | L5 | | `_synthesis_{field}.yaml` | 04-outputs/ | Per-field aggregation (YAML) | L6 | | `_synthesis_report.md` | 04-outputs/ | FULL FINAL REPORT (Markdown) | L7 | | Level | Output Format | Why | |-------|---------------|-----| | L1-L3 | YAML | Script-generated, machine-readable | | L4 | YAML | Struct...
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìã Sub-Steps</span>
                                    <span class="content-badge">6</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="substeps-list">
                                    <li class="substep-item">**SCRIPTS ARE DETERMINISTIC** - Levels 1-3, 5-6 use Python scripts, NOT LLM</li>
                                    <li class="substep-item">**ONLY 2 SUBAGENT LEVELS** - Level 4 (extraction) and Level 7 (report) use LLM</li>
                                    <li class="substep-item">**PRESERVE CITATIONS** - Every level keeps Paper-ID (Chunk:Line)</li>
                                    <li class="substep-item">**TOKEN BUDGET IS REAL** - Level 7 has calculated budget, can split</li>
                                    <li class="substep-item">**VERIFICATION IS MANDATORY** - Level 5 catches hallucinated quotes</li>
                                    <li class="substep-item">**YAML FOR SCRIPTS, MD FOR HUMANS** - Follow format rules</li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üíª Code Blocks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">yaml</span>
                                        <div class='code-context'>**Update project status:**

### Update overview.md</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>status: COMPLETE
completed_at: "{timestamp}"
synthesis_version: "7-level"</pre>
                                    </div>
                                </div>
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-language">text</span>
                                        <div class='code-context'>**Update project status:**

### Update overview.md

```yaml
status: COMPLETE
completed_at: "{timestamp}"
synthesis_version: "7-level"
```

### Final Summary</div>
                                    </div>
                                    <div class="code-content">
                                        <pre>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
7-LEVEL SYNTHESIS COMPLETE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Project: {name}
Research Question: "{RQ}"
Research Purpose: "{purpose}"

Pipeline Summary:
  Level 1 (Routing):     127 chunks routed
  Level 2 (Allocation):  45 batches calculated
  Level 3 (Prompts):     45 prompts generated
  Level 4 (Extraction):  45 batches extracted
  Level 5 (Verification): 93.3% verified
  Level 6 (Aggregation): 156 unique patterns
  Level 7 (Report):      1 comprehensive report

Outputs:
  üìÑ 04-outputs/_synthesis_report.md (FULL REPORT)
  üìä 04-outputs/_synthesis_{field}.yaml ({M} field aggregations)
  üìã 03-working/_verification_report.yaml

Deterministic Scripts Used:
  ‚úì build_synthesis_routing.py (Level 1)
  ‚úì calculate_subagent_allocation.py (Level 2)
  ‚úì generate_subagent_prompts.py (Level 3)
  ‚úì verify_subagent_output.py (Level 5)
  ‚úì aggregate_patterns.py (Level 6)

Next steps:
  ‚Ä¢ Review synthesis report
  ‚Ä¢ Export findings
  ‚Ä¢ Archive or close project

Say "close session" to save learnings.
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üìä Tables</span>
                                    <span class="content-badge">5</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="table-wrapper">
                                    <div class='table-context'>## Files Created by This Skill</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>File</th>
                                                <th>Location</th>
                                                <th>Purpose</th>
                                                <th>Level</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>`_synthesis_routing.yaml`</td>
                                                <td>02-resources/</td>
                                                <td>Routing table (from chunk_index)</td>
                                                <td>L1</td>
                                            </tr>
                                            <tr>
                                                <td>`_subagent_plan.yaml`</td>
                                                <td>02-resources/</td>
                                                <td>Allocation + token budgets</td>
                                                <td>L2</td>
                                            </tr>
                                            <tr>
                                                <td>`_prompt_{batch_id}.md`</td>
                                                <td>03-working/prompts/</td>
                                                <td>Generated subagent prompts</td>
                                                <td>L3</td>
                                            </tr>
                                            <tr>
                                                <td>`_batch_{field}_{N}.yaml`</td>
                                                <td>03-working/</td>
                                                <td>Batch extraction outputs (YAML)</td>
                                                <td>L4</td>
                                            </tr>
                                            <tr>
                                                <td>`_verification_report.yaml`</td>
                                                <td>03-working/</td>
                                                <td>Quote-line verification</td>
                                                <td>L5</td>
                                            </tr>
                                            <tr>
                                                <td>`_synthesis_{field}.yaml`</td>
                                                <td>04-outputs/</td>
                                                <td>Per-field aggregation (YAML)</td>
                                                <td>L6</td>
                                            </tr>
                                            <tr>
                                                <td>`_synthesis_report.md`</td>
                                                <td>04-outputs/</td>
                                                <td>FULL FINAL REPORT (Markdown)</td>
                                                <td>L7</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Output Format by Level</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Level</th>
                                                <th>Output Format</th>
                                                <th>Why</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>L1-L3</td>
                                                <td>YAML</td>
                                                <td>Script-generated, machine-readable</td>
                                            </tr>
                                            <tr>
                                                <td>L4</td>
                                                <td>YAML</td>
                                                <td>Structured for aggregation script</td>
                                            </tr>
                                            <tr>
                                                <td>L5</td>
                                                <td>YAML</td>
                                                <td>Verification data for retry logic</td>
                                            </tr>
                                            <tr>
                                                <td>L6</td>
                                                <td>YAML</td>
                                                <td>Structured patterns for Level 7</td>
                                            </tr>
                                            <tr>
                                                <td>L7</td>
                                                <td>Markdown</td>
                                                <td>Human-readable final report</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Error Handling (7-Level)</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Step</th>
                                                <th>Level</th>
                                                <th>Error</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Step 1</td>
                                                <td>-</td>
                                                <td>No chunk_index</td>
                                                <td>Re-analyze with Schema 2.3</td>
                                            </tr>
                                            <tr>
                                                <td>Step 2</td>
                                                <td>L1</td>
                                                <td>Script fails</td>
                                                <td>Check index.md format</td>
                                            </tr>
                                            <tr>
                                                <td>Step 3</td>
                                                <td>L2</td>
                                                <td>Token budget overflow</td>
                                                <td>Increase split thresholds</td>
                                            </tr>
                                            <tr>
                                                <td>Step 4</td>
                                                <td>L3</td>
                                                <td>Missing briefing fields</td>
                                                <td>Add to _briefing.md</td>
                                            </tr>
                                            <tr>
                                                <td>Step 5</td>
                                                <td>L4</td>
                                                <td>Subagent fails</td>
                                                <td>Retry once with smaller batch</td>
                                            </tr>
                                            <tr>
                                                <td>Step 6</td>
                                                <td>L5</td>
                                                <td>Verification <90%</td>
                                                <td>Re-extract worst batches</td>
                                            </tr>
                                            <tr>
                                                <td>Step 7</td>
                                                <td>L6</td>
                                                <td>Aggregation merge conflict</td>
                                                <td>Manual review</td>
                                            </tr>
                                            <tr>
                                                <td>Step 8</td>
                                                <td>L7</td>
                                                <td>Token budget exceeded</td>
                                                <td>Split into priority passes</td>
                                            </tr>
                                            <tr>
                                                <td>Step 9</td>
                                                <td>-</td>
                                                <td>Status update fails</td>
                                                <td>Manual update overview.md</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>## Concurrency & Performance</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Setting</th>
                                                <th>Value</th>
                                                <th>Notes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Max concurrent extraction subagents</td>
                                                <td>15</td>
                                                <td>Level 4 parallel</td>
                                            </tr>
                                            <tr>
                                                <td>Timeout per extraction batch</td>
                                                <td>5 min</td>
                                                <td>Large chunks</td>
                                            </tr>
                                            <tr>
                                                <td>Token budget per batch (L4)</td>
                                                <td>70,000</td>
                                                <td>Standard formula: chars // 4</td>
                                            </tr>
                                            <tr>
                                                <td>Token budget for Level 7</td>
                                                <td>Calculated</td>
                                                <td>From _subagent_plan.yaml</td>
                                            </tr>
                                            <tr>
                                                <td>Retry on failure</td>
                                                <td>1</td>
                                                <td>Single retry</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-wrapper">
                                    <div class='table-context'>### Deterministic Scripts (NEW)</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Script</th>
                                                <th>Level</th>
                                                <th>Location</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>build_synthesis_routing.py</td>
                                                <td>L1</td>
                                                <td>validation/scripts/</td>
                                            </tr>
                                            <tr>
                                                <td>calculate_subagent_allocation.py</td>
                                                <td>L2</td>
                                                <td>validation/scripts/</td>
                                            </tr>
                                            <tr>
                                                <td>generate_subagent_prompts.py</td>
                                                <td>L3</td>
                                                <td>validation/scripts/</td>
                                            </tr>
                                            <tr>
                                                <td>verify_subagent_output.py</td>
                                                <td>L5</td>
                                                <td>validation/scripts/</td>
                                            </tr>
                                            <tr>
                                                <td>aggregate_patterns.py</td>
                                                <td>L6</td>
                                                <td>validation/scripts/</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>‚úÖ Validation Checks</span>
                                    <span class="content-badge">2</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <ul class="validation-list">
                                    <li class="validation-item critical">
                                        <div class="validation-icon">!</div>
                                        <div>
                                            <span class="validation-type">critical</span>
                                            Reminders (7-Level)
                                        </div>
                                    </li>
                                    <li class="validation-item">
                                        <div class="validation-icon">‚úì</div>
                                        <div>
                                            <span class="validation-type">assertion</span>
                                            index.md format |
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üîß Error Handlers</span>
                                    <span class="content-badge">9</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="error-handler">
                                    <div class="error-type">No chunk_index</div>
                                    <div class="error-solution">Re-analyze with Schema 2.3</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Script fails</div>
                                    <div class="error-solution">Check index.md format</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Token budget overflow</div>
                                    <div class="error-solution">Increase split thresholds</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Missing briefing fields</div>
                                    <div class="error-solution">Add to _briefing.md</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Subagent fails</div>
                                    <div class="error-solution">Retry once with smaller batch</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Verification <90%</div>
                                    <div class="error-solution">Re-extract worst batches</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Aggregation merge conflict</div>
                                    <div class="error-solution">Manual review</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Token budget exceeded</div>
                                    <div class="error-solution">Split into priority passes</div>
                                </div>
                                <div class="error-handler">
                                    <div class="error-type">Status update fails</div>
                                    <div class="error-solution">Manual update overview.md</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-section">
                            <div class="content-section-header" onclick="toggleSection(this)">
                                <div class="content-section-title">
                                    <span>üèóÔ∏è Architecture Patterns</span>
                                    <span class="content-badge">4</span>
                                </div>
                                <span class="expand-icon">‚ñ∂</span>
                            </div>
                            <div class="content-section-body">
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">Level 1: |</span>
                                    </div>
                                    <div class="pattern-description">| `_subagent_plan.yaml` | 02-resources/ | Allocation + token budgets | L2 |
| `_prompt_{batch_id}.md` | 03-working/prompts/ | Generated subagent prompts | L3 |
| `_batch_{field}_{N}.yaml` | 03-working/ | Batch extraction outputs (YAML) | L4 |
| `_verification_report.yaml` | 03-working/ | Quote-line verification | L5 |
| `_synthesis_{field}.yaml` | 04-outputs/ | Per-field aggregation (YAML) | L6 |
</div>
                                    
                                </div>
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">Level 3: | YAML | Script-generated, machine-readable |</span>
                                    </div>
                                    <div class="pattern-description">| L4 | YAML | Structured for aggregation script |
| L5 | YAML | Verification data for retry logic |
| L6 | YAML | Structured patterns for Level 7 |
| L7 | Markdown | Human-readable final report |

**Rule**: Script levels output YAML, final subagent outputs Markdown.

---</div>
                                    
                                </div>
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">Level 1: | Script fails | Check index.md format |</span>
                                    </div>
                                    <div class="pattern-description">| Step 3 | L2 | Token budget overflow | Increase split thresholds |
| Step 4 | L3 | Missing briefing fields | Add to _briefing.md |
| Step 5 | L4 | Subagent fails | Retry once with smaller batch |
| Step 6 | L5 | Verification <90% | Re-extract worst batches |
| Step 7 | L6 | Aggregation merge conflict | Manual review |
| Step 8 | L7 | Token budget exceeded | Split into priority passes |
| Step 9 |</div>
                                    
                                </div>
                                <div class="pattern-item">
                                    <div class="pattern-header">
                                        <span class="pattern-name">Level 1: | validation/scripts/ |</span>
                                    </div>
                                    <div class="pattern-description">| calculate_subagent_allocation.py | L2 | validation/scripts/ |
| generate_subagent_prompts.py | L3 | validation/scripts/ |
| verify_subagent_output.py | L5 | validation/scripts/ |
| aggregate_patterns.py | L6 | validation/scripts/ |

---

**Version**: 2.0 (2025-12-28)
**Major Changes**:
- v1.0: Initial 4-level architecture
- v2.0: 7-level architecture with deterministic scripts (Gap G2, G13, G15,</div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function scrollToStep(stepNum) {
            const element = document.getElementById(`step-${stepNum}`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.closest('.nav-item').classList.add('active');
            }
        }

        function toggleSection(header) {
            const body = header.nextElementSibling;
            header.classList.toggle('expanded');
            body.classList.toggle('expanded');
        }

        // Highlight active section on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const stepNum = entry.target.id.replace('step-', '');
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    const activeNav = document.querySelector(`[onclick="scrollToStep(${stepNum})"]`);
                    if (activeNav) {
                        activeNav.classList.add('active');
                    }
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll('.step-card').forEach(card => {
            observer.observe(card);
        });
    </script>
</body>
</html>
