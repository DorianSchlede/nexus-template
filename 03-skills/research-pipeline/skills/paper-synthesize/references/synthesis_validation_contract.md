# Synthesis Validation Contract

This document defines the validation requirements for `_synthesis.md` files generated by the paper-synthesize skill.

---

## Required Frontmatter

Every `_synthesis.md` MUST include this YAML frontmatter:

```yaml
---
# REQUIRED FIELDS
synthesized_at: "2025-12-19T16:30:00"
research_question: "What are the proven patterns..."
papers_included: 38
papers_excluded: 5

# RECOMMENDED FIELDS (for validation)
papers_read: ["01-autogen", "02-autogen-studio", "..."]  # Actual papers read
excluded_papers: ["04-sagallm", "..."]  # Papers intentionally excluded
total_patterns_extracted:
  handover_patterns: 47
  quality_mechanisms: 32
  prompt_templates: 28
  orchestration_algo: 19
coverage_percentage: 85  # patterns_in_synthesis / patterns_in_sources

# OPTIONAL METADATA
generation_model: "claude-opus-4-20250514"
synthesis_method: "cross-paper aggregation"
---
```

---

## Validation Checks

### 1. Frontmatter Validation

| Field | Required | Validation |
|-------|----------|------------|
| `synthesized_at` | YES | Valid timestamp |
| `research_question` | YES | Non-empty string |
| `papers_included` | YES | Integer > 0 |
| `papers_excluded` | YES | Integer >= 0 |
| `papers_read` | RECOMMENDED | List of paper_ids |
| `total_patterns_extracted` | RECOMMENDED | Dict with counts |
| `coverage_percentage` | RECOMMENDED | 0-100 integer |

### 2. Paper Reference Validation

For each paper cited in the synthesis:

```python
# Check paper exists
paper_path = f"{project}/02-resources/papers/{paper_id}/index.md"
assert paper_path.exists(), f"Cited paper not found: {paper_id}"
```

### 3. Claim Spot-Checking

For N random claims (default: 10):

```python
# Extract claims with sources
claims = extract_claims("MAPoRL: 91% accuracy", source="42-maporl")

# Verify in source
source_content = read(f"papers/{source}/index.md")
assert "91%" in source_content, f"Claim not found in source"
```

### 4. Coverage Calculation

```python
# Count patterns in all source index.md files
source_patterns = sum([
    paper.high_priority_fields_found
    for paper in papers
])

# Count patterns documented in synthesis
synthesis_patterns = count_pattern_sections(synthesis)

# Calculate coverage
coverage = synthesis_patterns / source_patterns
assert coverage >= 0.7, "Coverage below 70%"
```

---

## Validation Script Usage

```bash
# Basic validation
python 03-skills/research-pipeline/skills/paper-synthesize/scripts/validate_synthesis.py \
  02-projects/10-multi-agent-algorithms-research

# With spot-checking
python 03-skills/research-pipeline/skills/paper-synthesize/scripts/validate_synthesis.py \
  02-projects/10-multi-agent-algorithms-research \
  --spot-check 20

# Output report to file
python 03-skills/research-pipeline/skills/paper-synthesize/scripts/validate_synthesis.py \
  02-projects/10-multi-agent-algorithms-research \
  --output 04-outputs/_synthesis_validation.md
```

---

## Validation Thresholds

| Metric | Pass | Warn | Fail |
|--------|------|------|------|
| Frontmatter completeness | 100% required | <100% recommended | Missing required |
| Paper reference accuracy | 100% exist | >90% exist | <90% exist |
| Spot-check verification | >90% verified | 70-90% verified | <70% verified |
| Coverage | >80% | 60-80% | <60% |

---

## Synthesis Subagent Contract

When spawning a synthesis subagent, include these validation requirements:

```
VALIDATION CONTRACT:

1. You MUST read ALL index.md files matching: papers/*/index.md
2. You MUST log which papers you actually read in frontmatter: papers_read: [...]
3. You MUST count patterns extracted from each paper
4. Every claim MUST cite paper_id (e.g., "MAPoRL achieves 91%")
5. Include chunk_ref where available (e.g., "Chunk 3")

Your output will be validated by:
- Checking papers_read matches actual paper folders
- Spot-checking 10 random claims against source index.md
- Calculating coverage (patterns in synthesis / patterns in sources)

If validation fails, the synthesis will be regenerated.
```

---

## Two-Pass Synthesis (Recommended)

For high-reliability synthesis:

### Pass 1: Aggregation
```
Task(
  subagent_type="general-purpose",
  prompt="Read all index.md files, aggregate patterns, generate draft synthesis..."
)
```

### Pass 2: Verification
```
Task(
  subagent_type="general-purpose",
  prompt="Cross-reference 20% of claims in synthesis against source papers.
  Flag any mismatches. Add confidence score to frontmatter."
)
```

---

## Example Validated Frontmatter

```yaml
---
synthesized_at: "2025-12-19T16:45:00"
research_question: "What are the proven patterns, algorithms, and prompt strategies for sub-agent quality control and inter-agent handover in multi-agent LLM systems?"
papers_included: 38
papers_excluded: 5
papers_read:
  - "01-autogen"
  - "02-autogen-studio"
  - "03-small-llms-multi-agent"
  - "05-agentcoord"
  # ... all 38 papers
excluded_papers:
  - paper_id: "04-sagallm"
    reason: "Domain mismatch - schizophrenia EEG classification"
  - paper_id: "17-market-making-coordination"
    reason: "Domain mismatch - UAV 3D rendering"
  - paper_id: "27-blockagents"
    reason: "Domain mismatch - chip design ML"
  - paper_id: "36-agent-warpp"
    reason: "Domain mismatch - GAN astronomy"
  - paper_id: "44-multi-agent-engineering"
    reason: "Domain mismatch - Markov chain math"
total_patterns_extracted:
  handover_patterns: 47
  quality_mechanisms: 32
  prompt_templates: 28
  orchestration_algo: 19
coverage_percentage: 85
validation:
  spot_checks_passed: 10
  spot_checks_total: 10
  confidence: "high"
---
```

---

**Version**: 1.0 (2025-12-19)
**Created for**: Research pipeline synthesis validation
