# {{ chain_name }} Skill-Chain Contract
# Generated: {{ generated_date }}
#
# This file defines the structure, skills, outputs, and gates for the skill-chain.
# Used by validation tools to verify chain execution.

name: {{ chain_name }}
version: "{{ version | default('1.0') }}"
description: "{{ description }}"
generated: {{ generated_date }}

structure:
  type: nested
  parent_skill: SKILL.md
  subfolders:
    - orchestrators
    - skills
    - shared
    - validation

skills:
{% for phase in phases %}
  # Phase {{ loop.index }}: {{ phase.name | title }}
  - id: {{ phase.orchestrator }}
    phase: {{ loop.index }}
    type: orchestrator
    path: orchestrators/{{ phase.orchestrator }}/SKILL.md
    description: "{{ phase.description | default('Phase ' ~ loop.index ~ ' orchestrator') }}"
    uses:
{% for skill in phase.sub_skills %}
      - {{ skill }}
{% endfor %}
{% if phase.outputs %}
    produces:
{% for output in phase.outputs %}
      - path: "{{ output.path }}"
{% if output.required is defined %}
        required: {{ output.required | lower }}
{% endif %}
{% if output.schema is defined %}
        schema: {{ output.schema }}
{% endif %}
{% if output.min_count is defined %}
        min_count: {{ output.min_count }}
{% endif %}
{% if output.validates is defined %}
        validates:
{% for validate in output.validates %}
          - {{ validate }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% if phase.gate %}
    gate: {{ phase.gate.name }}
{% endif %}

{% for skill in phase.sub_skills %}
  - id: {{ skill }}
    phase: {{ loop.index }}
    type: sub-skill
    path: skills/{{ skill }}/SKILL.md
    called_by: {{ phase.orchestrator }}

{% endfor %}
{% endfor %}

{% if shared_skills %}
  # Shared Methodologies
{% for shared in shared_skills %}
  - id: {{ shared }}
    type: shared-methodology
    path: shared/{{ shared }}/SKILL.md
    note: "DO NOT LOAD DIRECTLY - loaded by subagents"

{% endfor %}
{% endif %}

{% if schemas %}
schemas:
{% for name, schema in schemas.items() %}
  {{ name }}:
{% if schema.required_fields %}
    required_fields:
{% for field in schema.required_fields %}
      - {{ field }}
{% endfor %}
{% endif %}
{% if schema.optional_fields %}
    optional_fields:
{% for field in schema.optional_fields %}
      - {{ field }}
{% endfor %}
{% endif %}

{% endfor %}
{% endif %}

{% if gates %}
gates:
{% for phase in phases %}
{% if phase.gate %}
  {{ phase.gate.name }}:
    after_phase: {{ loop.index }}
{% if phase.gate.conditions %}
    checks:
{% for condition in phase.gate.conditions %}
      - "{{ condition }}"
{% endfor %}
{% endif %}

{% endif %}
{% endfor %}
{% endif %}
