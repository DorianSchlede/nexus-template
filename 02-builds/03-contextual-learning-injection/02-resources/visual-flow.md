# Contextual Learning Injection - Visueller Flow

**Build**: 03-contextual-learning-injection
**Erstellt**: 2026-01-23

---

## Flow 1: Kompletter User Journey (First Build)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER STARTET SESSION                                             â”‚
â”‚ "Ich brauche ein Rezeptbuch mit 100 Rezepten"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEXUS ORCHESTRATOR                                               â”‚
â”‚ â€¢ Analysiert User Intent                                         â”‚
â”‚ â€¢ Erkennt: Build-Bedarf (nicht einfache Task)                   â”‚
â”‚ â€¢ Routing-Entscheidung: plan-build                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE: Read Tool                                                â”‚
â”‚ file_path: 00-system/skills/builds/plan-build/SKILL.md         â”‚
â”‚ [LÃ¤dt Skill-Inhalt...]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Tool execution complete
             â–¼
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â•‘ POST TOOL USE HOOK (.claude/hooks/post_tool_use.py)            â•‘
â•‘                                                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ 1. EXTRACT TOOL INFO                                      â”‚  â•‘
â•‘  â”‚    â€¢ tool_name = os.environ['ANTHROPIC_TOOL_NAME']       â”‚  â•‘
â•‘  â”‚    â€¢ tool_input = JSON parse                              â”‚  â•‘
â•‘  â”‚    â€¢ file_path = tool_input['file_path']                 â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                   â”‚                                              â•‘
â•‘                   â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ 2. LOAD USER CONFIG                                       â”‚  â•‘
â•‘  â”‚    config = load_yaml('01-memory/user-config.yaml')      â”‚  â•‘
â•‘  â”‚    encounters = config['first_encounters']                â”‚  â•‘
â•‘  â”‚    â€¢ learn_builds_offered: False  â† KEY!                  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                   â”‚                                              â•‘
â•‘                   â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ 3. CHECK LEARNING TRIGGERS (Priority Loop)                â”‚  â•‘
â•‘  â”‚                                                            â”‚  â•‘
â•‘  â”‚    FOR skill_id, skill_data IN LEARNING_SKILLS:           â”‚  â•‘
â•‘  â”‚                                                            â”‚  â•‘
â•‘  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â•‘
â•‘  â”‚      â”‚ skill_id = 'learn_builds_offered'       â”‚          â”‚  â•‘
â•‘  â”‚      â”‚ encounters[skill_id] = False            â”‚          â”‚  â•‘
â•‘  â”‚      â”‚         â†“                                â”‚          â”‚  â•‘
â•‘  â”‚      â”‚   Continue checking...                  â”‚          â”‚  â•‘
â•‘  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â•‘
â•‘  â”‚                      â†“                                     â”‚  â•‘
â•‘  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â•‘
â•‘  â”‚      â”‚ FOR trigger_fn IN triggers:             â”‚          â”‚  â•‘
â•‘  â”‚      â”‚   IF trigger_fn(tool, path):            â”‚          â”‚  â•‘
â•‘  â”‚      â”‚                                          â”‚          â”‚  â•‘
â•‘  â”‚      â”‚     â€¢ tool = "Read" âœ“                   â”‚          â”‚  â•‘
â•‘  â”‚      â”‚     â€¢ path contains "plan-build" âœ“      â”‚          â”‚  â•‘
â•‘  â”‚      â”‚                                          â”‚          â”‚  â•‘
â•‘  â”‚      â”‚     â†’ MATCH FOUND!                      â”‚          â”‚  â•‘
â•‘  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                   â”‚                                              â•‘
â•‘                   â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ 4. GENERATE PROMPT                                        â”‚  â•‘
â•‘  â”‚    prompt = skill_data['prompt_template'].format(...)    â”‚  â•‘
â•‘  â”‚                                                            â”‚  â•‘
â•‘  â”‚    Contains:                                              â”‚  â•‘
â•‘  â”‚    â€¢ "ğŸ¯ FIRST TIME: BUILD PLANNING"                     â”‚  â•‘
â•‘  â”‚    â€¢ User choice (1/2/3)                                  â”‚  â•‘
â•‘  â”‚    â€¢ Handling instructions for each choice               â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                   â”‚                                              â•‘
â•‘                   â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ 5. INJECT via additionalContext                          â”‚  â•‘
â•‘  â”‚                                                            â”‚  â•‘
â•‘  â”‚    output = {                                             â”‚  â•‘
â•‘  â”‚      "hookSpecificOutput": {                              â”‚  â•‘
â•‘  â”‚        "hookEventName": "PostToolUse",                    â”‚  â•‘
â•‘  â”‚        "additionalContext": prompt                        â”‚  â•‘
â•‘  â”‚      }                                                     â”‚  â•‘
â•‘  â”‚    }                                                       â”‚  â•‘
â•‘  â”‚                                                            â”‚  â•‘
â•‘  â”‚    print(json.dumps(output))                              â”‚  â•‘
â•‘  â”‚    sys.exit(0)                                            â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                  â•‘
â•‘  NOTE: Flag is NOT set here! Claude sets it later.              â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             â”‚
             â”‚ Hook output captured
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE CODE EXTENSION                                            â”‚
â”‚ â€¢ Receives hook JSON output                                      â”‚
â”‚ â€¢ Extracts additionalContext                                     â”‚
â”‚ â€¢ Appends to Claude's context window                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE (Enhanced Context)                                        â”‚
â”‚                                                                   â”‚
â”‚ Context Window contains:                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. Original Task: "Plan build for recipe book"             â”‚ â”‚
â”‚ â”‚ 2. Loaded Skill: plan-build/SKILL.md content               â”‚ â”‚
â”‚ â”‚ 3. INJECTED: Learning prompt with 1/2/3 choices            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚ Claude now shows user the prompt...                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE â†’ USER                                                    â”‚
â”‚                                                                   â”‚
â”‚ ğŸ¯ FIRST TIME: BUILD PLANNING                                   â”‚
â”‚                                                                   â”‚
â”‚ This is your first time planning a build. Would you like me to: â”‚
â”‚ 1) Load the 8-10 min "Learn Builds" lesson now                  â”‚
â”‚    (covers: Builds vs Skills, Decision Framework, Structure)     â”‚
â”‚ 2) Skip for now (I'll ask again next time)                      â”‚
â”‚ 3) Skip forever (don't ask again)                               â”‚
â”‚                                                                   â”‚
â”‚ Choose 1, 2, or 3.                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ User responds
             â–¼
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚ User    â”‚
        â”‚ Choice  â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚        â”‚
    â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1   â”‚ â”‚  2   â”‚ â”‚    3     â”‚
â”‚ Load  â”‚ â”‚ Skip â”‚ â”‚  Skip    â”‚
â”‚Lesson â”‚ â”‚ Now  â”‚ â”‚ Forever  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚        â”‚         â”‚
    â”‚        â”‚         â”‚
    â–¼        â–¼         â–¼
```

---

## Flow 2: User Choice Handling (Detail)

### Choice 1: Load Lesson

```
User: "1"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE EXECUTES:                                     â”‚
â”‚                                                       â”‚
â”‚ 1. Read: 00-system/skills/learning/                 â”‚
â”‚          learn-builds/SKILL.md                       â”‚
â”‚    [250+ lines of learning content]                 â”‚
â”‚                                                       â”‚
â”‚ 2. Execute Lesson:                                   â”‚
â”‚    â€¢ Explain Builds vs Skills                       â”‚
â”‚    â€¢ Show Decision Framework                        â”‚
â”‚    â€¢ Teach Build Structure                          â”‚
â”‚    â€¢ Demo Build Lifecycle                           â”‚
â”‚    [Interactive Q&A with user...]                   â”‚
â”‚                                                       â”‚
â”‚ 3. Edit: 01-memory/user-config.yaml                 â”‚
â”‚    Set: learn_builds_offered: true                  â”‚
â”‚                                                       â”‚
â”‚ 4. Continue with original task:                     â”‚
â”‚    "Now let's plan your recipe book build..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Choice 2: Skip Now

```
User: "2"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE EXECUTES:                                     â”‚
â”‚                                                       â”‚
â”‚ 1. NO file read                                      â”‚
â”‚ 2. NO config edit                                    â”‚
â”‚ 3. Continue immediately:                             â”‚
â”‚    "Understood! Let's plan your recipe book..."     â”‚
â”‚                                                       â”‚
â”‚ IMPORTANT: Flag stays FALSE                          â”‚
â”‚ â†’ Next time plan-build triggers: Ask again!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Choice 3: Skip Forever

```
User: "3"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE EXECUTES:                                     â”‚
â”‚                                                       â”‚
â”‚ 1. NO lesson read                                    â”‚
â”‚ 2. Edit: 01-memory/user-config.yaml                 â”‚
â”‚    Set: learn_builds_offered: true                  â”‚
â”‚ 3. Continue immediately:                             â”‚
â”‚    "Got it! Let's plan your recipe book..."         â”‚
â”‚                                                       â”‚
â”‚ IMPORTANT: Flag is now TRUE                          â”‚
â”‚ â†’ Next time plan-build triggers: NO prompt!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flow 3: Multi-Trigger Scenario

```
SESSION 1: First Build
    â†“
User: "create recipe book"
    â†“
Hook detects: plan-build
    â†“
learn_builds_offered: False â†’ TRIGGER
    â†“
Claude asks 1/2/3 â†’ User chooses "1"
    â†“
Lesson executed
    â†“
Flag set: learn_builds_offered: true
    â†“
Build planning continues...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SESSION 2: First Workspace Write
    â†“
User: "create folder for recipes"
    â†“
Hook detects: Write to 04-workspace/
    â†“
create_folders_offered: False â†’ TRIGGER
    â†“
Claude asks 1/2/3 â†’ User chooses "3" (skip forever)
    â†“
NO lesson executed
    â†“
Flag set: create_folders_offered: true
    â†“
Folder creation continues...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SESSION 3: Second Build
    â†“
User: "create marketing plan"
    â†“
Hook detects: plan-build
    â†“
learn_builds_offered: True â†’ SKIP (already offered)
    â†“
NO prompt shown
    â†“
Direct to planning...
```

---

## Flow 4: Hook Priority System

```
PostToolUse Hook Execution Order:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LEARNING_SKILLS (High Priority)     â”‚ â† NEW!
â”‚                                          â”‚
â”‚    â€¢ learn_builds_offered               â”‚
â”‚    â€¢ create_folders_offered             â”‚
â”‚                                          â”‚
â”‚    If ANY matches:                      â”‚
â”‚    â†’ Inject prompt                      â”‚
â”‚    â†’ Exit immediately                   â”‚
â”‚                                          â”‚
â”‚    If NO matches:                       â”‚
â”‚    â†’ Continue to next check             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MICRO_LESSONS (Low Priority)        â”‚ â† EXISTING
â”‚                                          â”‚
â”‚    â€¢ memory_updated                     â”‚
â”‚    â€¢ close_session_used                 â”‚
â”‚                                          â”‚
â”‚    If matches:                          â”‚
â”‚    â†’ Inject hardcoded text tip          â”‚
â”‚    â†’ Exit                               â”‚
â”‚                                          â”‚
â”‚    If NO matches:                       â”‚
â”‚    â†’ Silent exit                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why this order?**

Learning Skills > Micro Lessons because:
- Learning context more valuable than tips
- User explicitly triggering learning-worthy action
- Prevents tip spam when lesson is more appropriate

---

## Flow 5: Error Handling Paths

### Error Path 1: Skill File Missing

```
Hook detects trigger
    â†“
Try to generate prompt
    â†“
Read skill_path: "00-system/skills/learning/learn-builds/SKILL.md"
    â†“
FileNotFoundError!
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CATCH EXCEPTION                          â”‚
â”‚ â€¢ Log error                              â”‚
â”‚ â€¢ sys.exit(0)  (graceful)               â”‚
â”‚ â€¢ No crash, no user interruption        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Claude continues normally (no prompt shown)
```

### Error Path 2: Config File Corrupted

```
Hook tries to load config
    â†“
YAML parse error
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CATCH YAMLError                          â”‚
â”‚ â€¢ Default: encounters = {}               â”‚
â”‚ â€¢ Treat all flags as False               â”‚
â”‚ â€¢ Offer all lessons                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Hook continues (conservative behavior)
```

### Error Path 3: Hook Crashes

```
Unexpected exception
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GLOBAL TRY-EXCEPT                        â”‚
â”‚ â€¢ Log full traceback                     â”‚
â”‚ â€¢ sys.exit(0)                            â”‚
â”‚ â€¢ Claude Code continues                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
User sees: Normal workflow (no hook output)
```

---

## State Machine: Learning Skill Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEVER OFFERED  â”‚  â† Initial state
â”‚ Flag: False    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ User triggers action (e.g., first build)
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROMPT SHOWN   â”‚  â† Hook injected prompt
â”‚ Flag: False    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ User responds
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚          â”‚
    â–¼        â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Choice 1â”‚ â”‚Choice 2â”‚ â”‚  Choice 3  â”‚
â”‚Load    â”‚ â”‚Skip Nowâ”‚ â”‚Skip Foreverâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚            â”‚
    â”‚          â”‚            â”‚
    â–¼          â”‚            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXECUTING  â”‚ â”‚      â”‚ DISMISSED    â”‚
â”‚ Lesson...  â”‚ â”‚      â”‚ Flag: True   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚        â”‚             â”‚
      â”‚        â”‚             â”‚
      â–¼        â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚ COMPLETED  â”‚ â”‚             â”‚
â”‚ Flag: True â”‚ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
      â”‚        â”‚             â”‚
      â”‚        â”‚             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ NEVER ASK AGAIN  â”‚  â† Terminal state
     â”‚ Flag: True       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Future triggers
               â–¼
        Hook checks flag
               â†“
        Flag = True â†’ SKIP
```

**Note**: Choice 2 ("Skip Now") keeps Flag = False, so state returns to "NEVER OFFERED" and can be triggered again.

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FILE SYSTEM                                                   â”‚
â”‚                                                                â”‚
â”‚  01-memory/                                                   â”‚
â”‚  â””â”€ user-config.yaml                                          â”‚
â”‚     â””â”€ first_encounters:                                      â”‚
â”‚        â”œâ”€ learn_builds_offered: false    â”€â”€â”€â”€â”€â”              â”‚
â”‚        â”œâ”€ learn_skills_offered: false         â”‚              â”‚
â”‚        â””â”€ create_folders_offered: false       â”‚              â”‚
â”‚                                                â”‚              â”‚
â”‚  00-system/skills/learning/                   â”‚              â”‚
â”‚  â”œâ”€ learn-builds/SKILL.md      â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚              â”‚
â”‚  â”œâ”€ learn-skills/SKILL.md              â”‚      â”‚              â”‚
â”‚  â””â”€ create-folders/SKILL.md            â”‚      â”‚              â”‚
â”‚                                         â”‚      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚      â”‚
                                          â”‚      â”‚ READ
                                          â”‚      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                        â”‚                        â”‚
                        â”‚ READ                   â”‚
                        â”‚ (if user chooses 1)    â”‚
                        â”‚                        â”‚
                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST TOOL USE HOOK (Python)                                  â”‚
â”‚                                                                â”‚
â”‚  LEARNING_SKILLS = {                                          â”‚
â”‚    'learn_builds_offered': {                                  â”‚
â”‚       'triggers': [...],                                      â”‚
â”‚       'skill_path': '...learn-builds/SKILL.md',              â”‚
â”‚       'prompt_template': '...'                                â”‚
â”‚    }                                                           â”‚
â”‚  }                                                             â”‚
â”‚                                                                â”‚
â”‚  1. Load encounters (from config)  â—„â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  2. Check triggers                          â”‚                 â”‚
â”‚  3. Generate prompt                         â”‚                 â”‚
â”‚  4. Output JSON                             â”‚                 â”‚
â”‚                                              â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                            â”‚
                  â”‚ JSON Output                â”‚
                  â”‚ (additionalContext)        â”‚
                  â”‚                            â”‚
                  â–¼                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE CODE EXTENSION                        â”‚                â”‚
â”‚                                               â”‚                â”‚
â”‚  â€¢ Receives hook output                      â”‚                â”‚
â”‚  â€¢ Extracts additionalContext                â”‚                â”‚
â”‚  â€¢ Injects into Claude's context             â”‚                â”‚
â”‚                                               â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Enhanced Context
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLAUDE                                                        â”‚
â”‚                                                                â”‚
â”‚  â€¢ Sees original task                                         â”‚
â”‚  â€¢ Sees injected prompt                                       â”‚
â”‚  â€¢ Shows user 1/2/3 choice                                    â”‚
â”‚  â€¢ Handles user response                                      â”‚
â”‚                                                                â”‚
â”‚  IF Choice 1:                                                 â”‚
â”‚    â”œâ”€ Read SKILL.md  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚    â”œâ”€ Execute lesson               â”‚ (reads from filesystem) â”‚
â”‚    â””â”€ Set flag  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                          â”‚
â”‚                                â”‚   â”‚                          â”‚
â”‚  IF Choice 3:                  â”‚   â”‚                          â”‚
â”‚    â””â”€ Set flag  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚                          â”‚
â”‚                             â”‚  â”‚   â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚  â”‚   â”‚
                              â”‚  â”‚   â”‚ WRITE
                              â”‚  â”‚   â”‚
                              â–¼  â–¼   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FILE SYSTEM (Updated)                                         â”‚
â”‚                                                                â”‚
â”‚  01-memory/user-config.yaml                                   â”‚
â”‚  â””â”€ first_encounters:                                         â”‚
â”‚     â””â”€ learn_builds_offered: true  â—„â”€â”€â”€ WRITTEN BY CLAUDE    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction Timeline

```
Time â†’

T0: User sends message
    â”‚
    â””â”€â–º Nexus Orchestrator analyzes
            â”‚
            â””â”€â–º Decides: Load plan-build skill

T1: Claude executes Read tool
    â”‚
    â””â”€â–º Reads: plan-build/SKILL.md
            â”‚
            â””â”€â–º Tool completes

T2: PostToolUse hook starts
    â”‚
    â”œâ”€â–º Extract tool info (ANTHROPIC_TOOL_NAME, etc.)
    â”œâ”€â–º Load user-config.yaml
    â”œâ”€â–º Check LEARNING_SKILLS triggers
    â”œâ”€â–º Generate prompt
    â””â”€â–º Output JSON

T3: Hook completes
    â”‚
    â””â”€â–º Claude Code Extension receives output
            â”‚
            â””â”€â–º Injects additionalContext

T4: Claude receives enhanced context
    â”‚
    â””â”€â–º Displays prompt to user

T5: User responds (e.g., "1")
    â”‚
    â””â”€â–º Claude starts handling
            â”‚
            â”œâ”€â–º T6: Read SKILL.md
            â”œâ”€â–º T7: Execute lesson (8-10 min)
            â”œâ”€â–º T8: Edit user-config.yaml
            â””â”€â–º T9: Continue with original task

T10: Build planning continues...
```

---

*Visual flows complete. Ready for implementation.*
