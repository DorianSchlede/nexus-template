# User Config Onboarding State Documentation

> **Generated by**: Explore subagent a6e9a35
> **Date**: 2026-01-24
> **Purpose**: Complete documentation of onboarding state structure in user-config.yaml

---

## Executive Summary

The Nexus onboarding system uses `user-config.yaml` as the **single source of truth** for all onboarding state. The primary tracking mechanism is `learning_tracker.completed`, which maps 6 skill keys to boolean completion flags. All other state variables (goals_personalized, workspace_configured, onboarding_complete) are **derived** from this single source.

---

## File Locations

- **Template**: `/00-system/core/nexus/templates/user-config.yaml` (lines 1-65)
- **Active Instance**: `/01-memory/user-config.yaml` (lines 1-65)

---

## 1. ONBOARDING SECTION

**Location**: Lines 16-20

```yaml
onboarding:
  status: "not_started"
  current_session: 0
  last_completed: null
  sessions_completed: []
```

**Field Definitions**:

| Field | Type | Purpose | Example Values |
|-------|------|---------|-----------------|
| `status` | string | Current onboarding status | `"not_started"`, `"in_progress"`, `"completed"` |
| `current_session` | int | Which onboarding session number | `0` (not started), `1` (first), `2` (second) |
| `last_completed` | datetime/null | ISO timestamp of last completed step | `null` or `"2026-01-24T10:30:00"` |
| `sessions_completed` | list | History of completed onboarding sessions | `[]` or `["setup_memory", "create_folders"]` |

**State Transitions**:
- Initial: `status="not_started"`, `current_session=0`
- After setup-memory: `sessions_completed: ["setup_memory"]`
- After create-folders: `sessions_completed: ["setup_memory", "create_folders"]`
- After all 2 mandatory skills: `status="completed"`

---

## 2. FIRST_ENCOUNTERS SECTION

**Location**: Lines 22-27

```yaml
first_encounters:
  build_created: false
  skill_loaded: false
  workspace_used: false
  memory_updated: false
  close_session_used: false
```

**Purpose**: Track "first experience" moments for proactive UI suggestions and onboarding completion tracking.

---

## 3. LEARNING_TRACKER SECTION (PRIMARY STATE)

**Location**: Lines 32-43

```yaml
learning_tracker:
  session_count: 0
  completed:
    setup_memory: false
    create_folders: false
    learn_integrations: false
    learn_builds: false
    learn_skills: false
    learn_nexus: false
  dismissed: []
  last_suggested: null
  suggestion_preference: "normal"
```

**COMPLETED SUBFIELDS** (Lines 34-40):

| Skill Key | Skill Name | Priority | Time Est. |
|-----------|-----------|----------|-----------|
| `setup_memory` | setup-memory | critical | 8 min |
| `create_folders` | create-folders | high | 5-8 min |
| `learn_builds` | learn-builds | high | 8-10 min |
| `learn_skills` | learn-skills | high | 10-12 min |
| `learn_integrations` | learn-integrations | high | 10-12 min |
| `learn_nexus` | learn-nexus | medium | 15-18 min |

---

## State Transition Flow

### How Flags Change During Onboarding

**1. Startup Detection** (session_start.py, lines 596-623)
```python
Function: extract_learning_completed()
- Reads learning_tracker.completed from user-config.yaml
- Returns dict with all 6 skill flags
- Used by state.py to determine if user has completed onboarding
```

**2. State Calculation** (state.py, lines 360-398)
```python
Function: extract_learning_completed()
- Single source of truth for onboarding state
- Derived values:
  - goals_personalized = learning_completed.get("setup_memory", False)
  - workspace_configured = learning_completed.get("create_folders", False)
  - onboarding_complete = len(pending_onboarding) == 0
```

**3. Pending Onboarding Detection** (state.py, lines 335-357)
```python
Function: build_pending_onboarding()
- Iterates through ONBOARDING_SKILLS
- For each skill with completed[skill_key] == False:
  - Adds to pending list with metadata
- Returns list of incomplete skills to suggest
```

---

## Key Architectural Insights

### 1. Single Source of Truth
- **Primary**: `learning_tracker.completed` in user-config.yaml
- All other flags derived from this
- Checked at every session startup (session_start.py line 602)

### 2. Mandatory vs Optional Skills
- **Mandatory** (blocks onboarding_complete):
  - `setup_memory` (critical priority)
  - `create_folders` (high priority)
- **Optional** (educational):
  - `learn_builds`, `learn_skills`, `learn_integrations`, `learn_nexus`

### 3. State Validation Flow
```
Session Start
  ↓
determine_workspace_root()
  ↓
extract_learning_completed(config_path)  ← Source of truth
  ↓
build_pending_onboarding()  ← Calculate pending skills
  ↓
build_display_hints()  ← Generate UI suggestions
  ↓
Build XML context with state flags
  ↓
Return to Claude with onboarding context
```

---

## File Cross-References

| File | Lines | Purpose |
|------|-------|---------|
| `/00-system/core/nexus/templates/user-config.yaml` | 16-43 | Template structure |
| `/01-memory/user-config.yaml` | 16-43 | Active user state |
| `/00-system/core/nexus/config.py` | 73-114 | Skill definitions |
| `/00-system/core/nexus/state.py` | 335-398 | Pending onboarding logic |
| `/00-system/core/nexus/state.py` | 596-623 | XML context generation |
| `.claude/hooks/session_start.py` | 56-96 | User preference extraction |
| `.claude/hooks/session_start.py` | 596-623 | Startup state detection |
| `/00-system/skills/learning/setup-memory/SKILL.md` | 293-297 | Sets `setup_memory: true` |
| `/00-system/skills/learning/create-folders/SKILL.md` | 226-236 | Sets `create_folders: true` |
